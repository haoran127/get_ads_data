# ğŸ“Š AppsFlyer æ•°æ®åˆ†æä¸ä¼˜åŒ–æŒ‡å—

> åŸºäº AppsFlyer æ•°æ®è¿›è¡Œç§»åŠ¨å¹¿å‘Šåˆ†æå’Œä¼˜åŒ–çš„å®æˆ˜æŒ‡å—

---

## ğŸ“‹ ç›®å½•

1. [æ•°æ®åˆ†ææ¡†æ¶](#æ•°æ®åˆ†ææ¡†æ¶)
2. [æ ¸å¿ƒæŒ‡æ ‡ä½“ç³»](#æ ¸å¿ƒæŒ‡æ ‡ä½“ç³»)
3. [LTV ä¸ ROAS åˆ†æ](#ltv-ä¸-roas-åˆ†æ)
4. [æ¸ é“è¯„ä¼°ä¸ä¼˜åŒ–](#æ¸ é“è¯„ä¼°ä¸ä¼˜åŒ–)
5. [Cohort åˆ†æå®æˆ˜](#cohort-åˆ†æå®æˆ˜)
6. [SKAdNetwork æ•°æ®åˆ†æ](#skadnetwork-æ•°æ®åˆ†æ)
7. [åä½œå¼Šæ•°æ®åˆ†æ](#åä½œå¼Šæ•°æ®åˆ†æ)
8. [æ•°æ®ä»“åº“é›†æˆæ–¹æ¡ˆ](#æ•°æ®ä»“åº“é›†æˆæ–¹æ¡ˆ)

---

## æ•°æ®åˆ†ææ¡†æ¶

### ç§»åŠ¨å¹¿å‘Šæ•°æ®åˆ†æå…¨æ™¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç§»åŠ¨å¹¿å‘Šæ•°æ®åˆ†ææ¡†æ¶                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                     ç¬¬ä¸€å±‚ï¼šè§„æ¨¡ä¸æ•ˆç‡æŒ‡æ ‡                            â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   Installs â”‚ Spend â”‚ CPI â”‚ IPM â”‚ CTR â”‚ CVR                          â”‚   â”‚
â”‚   â”‚   (åšå¤§)     (æˆæœ¬)   (æ•ˆç‡)                                          â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                        â”‚
â”‚                                    â–¼                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                     ç¬¬äºŒå±‚ï¼šç”¨æˆ·è´¨é‡æŒ‡æ ‡                              â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   Retention(D1/D7/D30) â”‚ Session â”‚ Events â”‚ Registration Rate       â”‚   â”‚
â”‚   â”‚   (ç•™å­˜)                 (æ´»è·ƒ)    (è¡Œä¸º)    (è½¬åŒ–)                    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                        â”‚
â”‚                                    â–¼                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                     ç¬¬ä¸‰å±‚ï¼šä»·å€¼æŒ‡æ ‡                                  â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   Revenue â”‚ ARPU â”‚ ARPPU â”‚ LTV â”‚ ROAS â”‚ ROI                         â”‚   â”‚
â”‚   â”‚   (æ”¶å…¥)    (äººå‡) (ä»˜è´¹äººå‡) (ç»ˆèº«ä»·å€¼) (å›æŠ¥ç‡)                       â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                        â”‚
â”‚                                    â–¼                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                     ç¬¬å››å±‚ï¼šå¥åº·åº¦æŒ‡æ ‡                                â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   Fraud Rate â”‚ Valid Install Rate â”‚ Organic Ratio â”‚ Incremental    â”‚   â”‚
â”‚   â”‚   (ä½œå¼Šç‡)     (æœ‰æ•ˆå®‰è£…ç‡)          (è‡ªç„¶é‡å æ¯”)    (å¢é‡)            â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åˆ†æç»´åº¦çŸ©é˜µ

| ç»´åº¦ | ç²’åº¦é€‰é¡¹ | å…¸å‹åˆ†æåœºæ™¯ |
|-----|---------|------------|
| **æ—¶é—´** | æ—¥/å‘¨/æœˆ/Cohort | è¶‹åŠ¿åˆ†æã€å‘¨æœŸæ€§åˆ†æ |
| **æ¸ é“** | åª’ä½“/Campaign/Adset/Ad | æ¸ é“å¯¹æ¯”ã€é¢„ç®—åˆ†é… |
| **åœ°åŒº** | å›½å®¶/åœ°åŒº | å¸‚åœºè¯„ä¼°ã€åŒºåŸŸç­–ç•¥ |
| **å¹³å°** | iOS/Android | å¹³å°å·®å¼‚åˆ†æ |
| **è®¾å¤‡** | è®¾å¤‡å‹å·/OSç‰ˆæœ¬ | æŠ€æœ¯å…¼å®¹æ€§ã€ç”¨æˆ·ç”»åƒ |
| **ç´ æ** | åˆ›æ„/ç´ æç»„åˆ | ç´ ææ•ˆæœè¯„ä¼° |
| **äº‹ä»¶** | äº‹ä»¶å/äº‹ä»¶åºåˆ— | æ¼æ–—åˆ†æã€è¡Œä¸ºåˆ†æ |

---

## æ ¸å¿ƒæŒ‡æ ‡ä½“ç³»

### æŒ‡æ ‡å®šä¹‰

#### è§„æ¨¡æŒ‡æ ‡

| æŒ‡æ ‡ | å…¬å¼ | è¯´æ˜ |
|-----|------|------|
| **Installs** | æ–°å¢å®‰è£…æ•° | è¡¡é‡è·å®¢è§„æ¨¡ |
| **Re-Attribution** | è€ç”¨æˆ·å›å½’æ•° | å†è¥é”€æ•ˆæœ |
| **Re-Engagement** | è€ç”¨æˆ·å†æ¿€æ´»æ•° | å¬å›æ•ˆæœ |

#### æ•ˆç‡æŒ‡æ ‡

| æŒ‡æ ‡ | å…¬å¼ | è¯´æ˜ |
|-----|------|------|
| **CPI** | Spend / Installs | å•æ¬¡å®‰è£…æˆæœ¬ |
| **CPM** | (Spend / Impressions) Ã— 1000 | åƒæ¬¡å±•ç¤ºæˆæœ¬ |
| **CTR** | Clicks / Impressions | ç‚¹å‡»ç‡ |
| **CVR** | Installs / Clicks | è½¬åŒ–ç‡ï¼ˆç‚¹å‡»åˆ°å®‰è£…ï¼‰ |
| **IPM** | (Installs / Impressions) Ã— 1000 | åƒæ¬¡å±•ç¤ºå®‰è£…æ•° |

#### ç”¨æˆ·è´¨é‡æŒ‡æ ‡

| æŒ‡æ ‡ | å…¬å¼ | è¯´æ˜ |
|-----|------|------|
| **D1/D7/D30 Retention** | Dn æ´»è·ƒç”¨æˆ· / D0 å®‰è£…ç”¨æˆ· | ç¬¬ N å¤©ç•™å­˜ç‡ |
| **Registration Rate** | æ³¨å†Œç”¨æˆ· / å®‰è£…ç”¨æˆ· | æ³¨å†Œè½¬åŒ–ç‡ |
| **Purchase Rate** | ä»˜è´¹ç”¨æˆ· / å®‰è£…ç”¨æˆ· | ä»˜è´¹è½¬åŒ–ç‡ |
| **First Purchase Rate** | é¦–å……ç”¨æˆ· / å®‰è£…ç”¨æˆ· | é¦–å……ç‡ |

#### ä»·å€¼æŒ‡æ ‡

| æŒ‡æ ‡ | å…¬å¼ | è¯´æ˜ |
|-----|------|------|
| **Revenue** | æ€»æ”¶å…¥ | å¹¿å‘Šå¸¦æ¥çš„æ”¶å…¥ |
| **ARPU** | Revenue / Users | æ¯ç”¨æˆ·å¹³å‡æ”¶å…¥ |
| **ARPPU** | Revenue / Paying Users | æ¯ä»˜è´¹ç”¨æˆ·å¹³å‡æ”¶å…¥ |
| **LTV** | ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸæ€»ä»·å€¼ | é•¿æœŸä»·å€¼ |
| **ROAS** | Revenue / Spend | å¹¿å‘Šæ”¯å‡ºå›æŠ¥ç‡ |
| **ROI** | (Revenue - Spend) / Spend | æŠ•èµ„å›æŠ¥ç‡ |

### æŒ‡æ ‡çœ‹æ¿è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           æ—¥å¸¸ç›‘æ§çœ‹æ¿                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ğŸ“Š ä»Šæ—¥æ¦‚è§ˆ                                   ğŸ“ˆ è¶‹åŠ¿ï¼ˆè¿‘7å¤©ï¼‰              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ Spend      â”‚ $50,000 â”‚ â†‘ 5%        â”‚    â”‚                            â”‚ â”‚
â”‚   â”‚ Installs   â”‚ 10,000  â”‚ â†‘ 8%        â”‚    â”‚    [Spend & Installs è¶‹åŠ¿å›¾]â”‚ â”‚
â”‚   â”‚ CPI        â”‚ $5.00   â”‚ â†“ 3%        â”‚    â”‚                            â”‚ â”‚
â”‚   â”‚ D1 ROAS    â”‚ 15%     â”‚ â†‘ 2%        â”‚    â”‚                            â”‚ â”‚
â”‚   â”‚ D7 ROAS    â”‚ 45%     â”‚ â†‘ 5%        â”‚    â”‚                            â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚   ğŸ“± æ¸ é“è¡¨ç° Top 5                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ æ¸ é“          â”‚ Spend    â”‚ Installs â”‚ CPI   â”‚ D7 ROAS â”‚ çŠ¶æ€       â”‚   â”‚
â”‚   â”‚ Meta          â”‚ $20,000  â”‚ 4,500    â”‚ $4.44 â”‚ 52%     â”‚ ğŸŸ¢ è‰¯å¥½    â”‚   â”‚
â”‚   â”‚ Google        â”‚ $15,000  â”‚ 2,800    â”‚ $5.36 â”‚ 48%     â”‚ ğŸŸ¢ è‰¯å¥½    â”‚   â”‚
â”‚   â”‚ TikTok        â”‚ $8,000   â”‚ 1,800    â”‚ $4.44 â”‚ 35%     â”‚ ğŸŸ¡ å…³æ³¨    â”‚   â”‚
â”‚   â”‚ Unity Ads     â”‚ $4,000   â”‚ 600      â”‚ $6.67 â”‚ 28%     â”‚ ğŸ”´ é¢„è­¦    â”‚   â”‚
â”‚   â”‚ ironSource    â”‚ $3,000   â”‚ 300      â”‚ $10.00â”‚ 22%     â”‚ ğŸ”´ é¢„è­¦    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   âš ï¸ å¼‚å¸¸å‘Šè­¦                                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ â€¢ Unity Ads Campaign Xï¼šCPI è¾ƒæ˜¨æ—¥ä¸Šå‡ 30%ï¼Œå»ºè®®æ£€æŸ¥                  â”‚   â”‚
â”‚   â”‚ â€¢ TikTok D7 ROAS è¿ç»­ 3 å¤©ä½äºç›®æ ‡ï¼Œå»ºè®®ä¼˜åŒ–æˆ–å‡é¢„ç®—                   â”‚   â”‚
â”‚   â”‚ â€¢ Meta æŸ Adset ä½œå¼Šç‡å¼‚å¸¸å‡é«˜è‡³ 15%                                  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## LTV ä¸ ROAS åˆ†æ

### LTV è®¡ç®—æ–¹æ³•

#### æ–¹æ³•ä¸€ï¼šç®€å•å¤–æ¨æ³•

```
LTV_D30 é¢„æµ‹ = ARPU_D7 Ã— ç³»æ•°

å¸¸ç”¨ç³»æ•°å‚è€ƒï¼š
- æ¸¸æˆï¼šD7 ARPU Ã— 3~5 â‰ˆ D90 LTV
- ç”µå•†ï¼šD7 ARPU Ã— 2~3 â‰ˆ D90 LTV
- è®¢é˜…ï¼šé¦–æœˆæ”¶å…¥ Ã— ç”¨æˆ·ç•™å­˜æœˆæ•°
```

#### æ–¹æ³•äºŒï¼šCohort ç´¯ç§¯æ³•

```python
import pandas as pd
import numpy as np

def calculate_ltv_by_cohort(cohort_data):
    """
    åŸºäº Cohort æ•°æ®è®¡ç®— LTV
    
    cohort_data: DataFrame with columns:
        - cohort_date: å®‰è£…æ—¥æœŸ
        - day: ç¬¬å‡ å¤©ï¼ˆ0, 1, 3, 7, 14, 30...ï¼‰
        - users: ç”¨æˆ·æ•°
        - revenue: ç´¯ç§¯æ”¶å…¥
    """
    
    # è®¡ç®—æ¯å¤©çš„ ARPU
    cohort_data['arpu'] = cohort_data['revenue'] / cohort_data['users']
    
    # æŒ‰ cohort_date å’Œ day é€è§†
    ltv_pivot = cohort_data.pivot(
        index='cohort_date', 
        columns='day', 
        values='arpu'
    )
    
    # è®¡ç®—å¹³å‡ LTV æ›²çº¿
    avg_ltv_curve = ltv_pivot.mean()
    
    return avg_ltv_curve


def predict_ltv(current_day_arpu, current_day, target_day, ltv_curve):
    """
    åŸºäºå½“å‰ ARPU é¢„æµ‹ç›®æ ‡å¤© LTV
    """
    if current_day >= target_day:
        return current_day_arpu
    
    # è®¡ç®—å¢é•¿ç³»æ•°
    growth_ratio = ltv_curve[target_day] / ltv_curve[current_day]
    
    predicted_ltv = current_day_arpu * growth_ratio
    return predicted_ltv
```

### ROAS åˆ†ææ¡†æ¶

#### ROAS è®¡ç®—ç¤ºä¾‹

```python
def calculate_roas(spend, revenue, install_date, analysis_date, lookback_window=7):
    """
    è®¡ç®— ROAS
    
    å‚æ•°ï¼š
        spend: èŠ±è´¹
        revenue: æ”¶å…¥ï¼ˆéœ€è¦æŒ‰å½’å› çª—å£ç´¯ç§¯ï¼‰
        install_date: å®‰è£…æ—¥æœŸ
        analysis_date: åˆ†ææ—¥æœŸ
        lookback_window: å›çœ‹çª—å£ï¼ˆå¦‚ D7 ROASï¼‰
    """
    
    # æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„æ—¶é—´çª—å£
    days_since_install = (analysis_date - install_date).days
    
    if days_since_install < lookback_window:
        return None  # æ•°æ®ä¸æˆç†Ÿ
    
    roas = revenue / spend if spend > 0 else 0
    
    return roas


def analyze_roas_by_channel(df):
    """
    æŒ‰æ¸ é“åˆ†æ ROAS
    
    df: DataFrame with columns:
        - media_source
        - install_date
        - spend
        - d7_revenue
    """
    
    channel_roas = df.groupby('media_source').agg({
        'spend': 'sum',
        'd7_revenue': 'sum'
    })
    
    channel_roas['d7_roas'] = channel_roas['d7_revenue'] / channel_roas['spend']
    channel_roas = channel_roas.sort_values('d7_roas', ascending=False)
    
    return channel_roas
```

### ROAS ä¼˜åŒ–ç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ROAS ä¼˜åŒ–å†³ç­–çŸ©é˜µ                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚                          ROAS è¡¨ç°                                          â”‚
â”‚                    é«˜ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ ä½                                    â”‚
â”‚                                                                             â”‚
â”‚   è§„   é«˜    â”‚  ğŸŸ¢ æ‰©é‡          â”‚  ğŸŸ¡ ä¼˜åŒ–ç´ æ/å—ä¼—    â”‚                    â”‚
â”‚   æ¨¡         â”‚  å¢åŠ é¢„ç®—ï¼Œå¤åˆ¶   â”‚  æµ‹è¯•æ–°æ–¹å‘åæ‰©é‡    â”‚                    â”‚
â”‚   è¡¨         â”‚  æˆåŠŸç­–ç•¥         â”‚                     â”‚                    â”‚
â”‚   ç°   â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
â”‚        ä½    â”‚  ğŸŸ¡ ä¿æŒè§‚å¯Ÿ      â”‚  ğŸ”´ æš‚åœ/å¤§å¹…è°ƒæ•´    â”‚                    â”‚
â”‚              â”‚  å°è§„æ¨¡æµ‹è¯•       â”‚  åˆ†æåŸå› åé‡å¯      â”‚                    â”‚
â”‚              â”‚  å¯»æ‰¾æ‰©é‡æœºä¼š     â”‚                     â”‚                    â”‚
â”‚                                                                             â”‚
â”‚   è¡ŒåŠ¨æŒ‡å—ï¼š                                                                  â”‚
â”‚   â€¢ ROAS > ç›®æ ‡ ä¸” è§„æ¨¡å¤§ â†’ åŠ é¢„ç®— 20-30%                                    â”‚
â”‚   â€¢ ROAS > ç›®æ ‡ ä¸” è§„æ¨¡å° â†’ åˆ†æç“¶é¢ˆï¼Œæµ‹è¯•æ‰©é‡æ–¹æ³•                            â”‚
â”‚   â€¢ ROAS < ç›®æ ‡ ä¸” è§„æ¨¡å¤§ â†’ ä¼˜åŒ–å‡ºä»·/å—ä¼—/ç´ æï¼Œåˆ†æ­¥è°ƒæ•´                       â”‚
â”‚   â€¢ ROAS < ç›®æ ‡ ä¸” è§„æ¨¡å° â†’ æš‚åœï¼Œåˆ†æåé‡å¯æˆ–æ”¾å¼ƒ                            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ¸ é“è¯„ä¼°ä¸ä¼˜åŒ–

### æ¸ é“ç»¼åˆè¯„åˆ†æ¨¡å‹

```python
import pandas as pd
import numpy as np

def calculate_channel_score(channel_data, weights=None):
    """
    è®¡ç®—æ¸ é“ç»¼åˆè¯„åˆ†
    
    channel_data: DataFrame with columns:
        - media_source
        - installs
        - cpi
        - d7_roas
        - d7_retention
        - fraud_rate
    
    weights: dict of metric weights
    """
    
    if weights is None:
        weights = {
            'installs_score': 0.15,      # è§„æ¨¡
            'cpi_score': 0.20,           # æˆæœ¬æ•ˆç‡
            'd7_roas_score': 0.30,       # ä»·å€¼å›æŠ¥
            'd7_retention_score': 0.20,   # ç”¨æˆ·è´¨é‡
            'fraud_score': 0.15          # æµé‡å¥åº·
        }
    
    df = channel_data.copy()
    
    # è§„æ¨¡è¯„åˆ†ï¼ˆè¶Šå¤§è¶Šå¥½ï¼Œæ ‡å‡†åŒ–åˆ° 0-100ï¼‰
    df['installs_score'] = (df['installs'] / df['installs'].max()) * 100
    
    # CPI è¯„åˆ†ï¼ˆè¶Šä½è¶Šå¥½ï¼‰
    df['cpi_score'] = (1 - (df['cpi'] - df['cpi'].min()) / 
                       (df['cpi'].max() - df['cpi'].min())) * 100
    
    # ROAS è¯„åˆ†ï¼ˆè¶Šé«˜è¶Šå¥½ï¼‰
    df['d7_roas_score'] = (df['d7_roas'] / df['d7_roas'].max()) * 100
    
    # ç•™å­˜è¯„åˆ†ï¼ˆè¶Šé«˜è¶Šå¥½ï¼‰
    df['d7_retention_score'] = (df['d7_retention'] / df['d7_retention'].max()) * 100
    
    # åä½œå¼Šè¯„åˆ†ï¼ˆè¶Šä½è¶Šå¥½ï¼‰
    df['fraud_score'] = (1 - df['fraud_rate']) * 100
    
    # ç»¼åˆè¯„åˆ†
    df['total_score'] = (
        df['installs_score'] * weights['installs_score'] +
        df['cpi_score'] * weights['cpi_score'] +
        df['d7_roas_score'] * weights['d7_roas_score'] +
        df['d7_retention_score'] * weights['d7_retention_score'] +
        df['fraud_score'] * weights['fraud_score']
    )
    
    # è¯„çº§
    df['grade'] = pd.cut(
        df['total_score'],
        bins=[0, 40, 60, 80, 100],
        labels=['D', 'C', 'B', 'A']
    )
    
    return df.sort_values('total_score', ascending=False)
```

### é¢„ç®—åˆ†é…ä¼˜åŒ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        é¢„ç®—åˆ†é…ç­–ç•¥                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   åŸºäº ROAS çš„é¢„ç®—åˆ†é…æ¨¡å‹ï¼š                                                  â”‚
â”‚                                                                             â”‚
â”‚   1. è®¾å®šç›®æ ‡ ROASï¼ˆå¦‚ 80%ï¼‰                                                 â”‚
â”‚   2. å°†æ¸ é“åˆ†ä¸ºä¸‰ç±»ï¼š                                                        â”‚
â”‚                                                                             â”‚
â”‚      A ç±»ï¼ˆROAS > ç›®æ ‡ Ã— 1.2ï¼‰ï¼šé«˜å›æŠ¥æ¸ é“                                    â”‚
â”‚      â†’ åˆ†é… 50% é¢„ç®—ï¼Œç§¯ææ‰©é‡                                               â”‚
â”‚                                                                             â”‚
â”‚      B ç±»ï¼ˆç›®æ ‡ Ã— 0.8 < ROAS < ç›®æ ‡ Ã— 1.2ï¼‰ï¼šè¾¾æ ‡æ¸ é“                         â”‚
â”‚      â†’ åˆ†é… 35% é¢„ç®—ï¼Œç¨³å®šæŠ•æ”¾                                               â”‚
â”‚                                                                             â”‚
â”‚      C ç±»ï¼ˆROAS < ç›®æ ‡ Ã— 0.8ï¼‰ï¼šå¾…ä¼˜åŒ–æ¸ é“                                    â”‚
â”‚      â†’ åˆ†é… 15% é¢„ç®—ï¼Œæµ‹è¯•ä¼˜åŒ–                                               â”‚
â”‚                                                                             â”‚
â”‚   åŠ¨æ€è°ƒæ•´è§„åˆ™ï¼š                                                              â”‚
â”‚   â€¢ æ¯å‘¨è¯„ä¼°ä¸€æ¬¡ï¼ŒåŸºäº D7 ROAS                                               â”‚
â”‚   â€¢ è¿ç»­ 2 å‘¨ C ç±» â†’ æš‚åœæŠ•æ”¾                                                â”‚
â”‚   â€¢ A ç±»æŒç»­è¡¨ç°å¥½ â†’ é€æ­¥å¢åŠ é¢„ç®—ï¼ˆæ¯æ¬¡ +10-20%ï¼‰                              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Cohort åˆ†æå®æˆ˜

### Cohort æ•°æ®è·å–

```python
import requests
from datetime import datetime, timedelta

def get_cohort_data(v2_api_token: str, app_id: str, from_date: str, to_date: str, 
                    groupings: list = ['media_source'], 
                    kpis: list = ['users', 'revenue', 'retention'],
                    cohort_days: list = [0, 1, 3, 7, 14, 30]):
    """
    ä» AppsFlyer Cohort API è·å–æ•°æ®
    
    âš ï¸ æ³¨æ„ï¼šå¿…é¡»ä½¿ç”¨ V2 API Tokenï¼ˆJWT æ ¼å¼ï¼‰ï¼ŒV1 Token å·²äº 2023å¹´9æœˆåœç”¨
    
    Args:
        v2_api_token: AppsFlyer V2 API Tokenï¼ˆä» Dashboard â†’ Settings â†’ API Tokens è·å–ï¼‰
        app_id: åº”ç”¨ ID
        from_date: å¼€å§‹æ—¥æœŸ (YYYY-MM-DD)
        to_date: ç»“æŸæ—¥æœŸ (YYYY-MM-DD)
        groupings: åˆ†ç»„ç»´åº¦
        kpis: æŒ‡æ ‡åˆ—è¡¨
        cohort_days: Cohort å¤©æ•°åˆ—è¡¨
    """
    
    url = f"https://hq1.appsflyer.com/api/cohorts/v1/data/app/{app_id}"
    
    headers = {
        "Authorization": f"Bearer {v2_api_token}",  # V2 Token Bearer è®¤è¯
        "Content-Type": "application/json"
    }
    
    payload = {
        "cohort_type": "user_acquisition",
        "min_cohort_size": 1,
        "cohort_day": cohort_days,
        "from": from_date,
        "to": to_date,
        "groupings": groupings,
        "kpis": kpis
    }
    
    response = requests.post(url, headers=headers, json=payload)
    response.raise_for_status()  # æ£€æŸ¥ HTTP é”™è¯¯
    return response.json()
```

### Cohort ç•™å­˜åˆ†æ

```python
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

def analyze_retention_cohort(cohort_data):
    """
    åˆ†æç•™å­˜ Cohort
    """
    
    # è½¬æ¢ä¸º DataFrame
    df = pd.DataFrame(cohort_data['data'])
    
    # åˆ›å»ºç•™å­˜çƒ­åŠ›å›¾
    retention_pivot = df.pivot(
        index='cohort_date',
        columns='cohort_day',
        values='retention'
    )
    
    plt.figure(figsize=(12, 8))
    sns.heatmap(
        retention_pivot,
        annot=True,
        fmt='.1%',
        cmap='RdYlGn',
        vmin=0,
        vmax=1
    )
    plt.title('Retention Cohort Analysis')
    plt.xlabel('Days Since Install')
    plt.ylabel('Install Cohort')
    plt.tight_layout()
    plt.savefig('retention_cohort.png')
    
    return retention_pivot


def compare_channel_retention(cohort_data):
    """
    å¯¹æ¯”ä¸åŒæ¸ é“çš„ç•™å­˜æ›²çº¿
    """
    
    df = pd.DataFrame(cohort_data['data'])
    
    # æŒ‰æ¸ é“å’Œå¤©æ•°èšåˆ
    channel_retention = df.groupby(['media_source', 'cohort_day']).agg({
        'retention': 'mean'
    }).reset_index()
    
    # ç»˜åˆ¶ç•™å­˜æ›²çº¿
    plt.figure(figsize=(10, 6))
    
    for channel in channel_retention['media_source'].unique():
        channel_data = channel_retention[channel_retention['media_source'] == channel]
        plt.plot(
            channel_data['cohort_day'],
            channel_data['retention'],
            marker='o',
            label=channel
        )
    
    plt.xlabel('Days Since Install')
    plt.ylabel('Retention Rate')
    plt.title('Retention by Channel')
    plt.legend()
    plt.grid(True, alpha=0.3)
    plt.savefig('channel_retention.png')
    
    return channel_retention
```

### LTV Cohort åˆ†æ

```python
def analyze_ltv_cohort(cohort_data):
    """
    åˆ†æ LTV Cohort
    """
    
    df = pd.DataFrame(cohort_data['data'])
    
    # è®¡ç®— ARPU
    df['arpu'] = df['revenue'] / df['users']
    
    # æŒ‰æ¸ é“å¯¹æ¯” LTV æ›²çº¿
    ltv_by_channel = df.pivot_table(
        values='arpu',
        index='cohort_day',
        columns='media_source',
        aggfunc='mean'
    )
    
    # ç»˜åˆ¶ LTV æ›²çº¿
    plt.figure(figsize=(10, 6))
    
    for channel in ltv_by_channel.columns:
        plt.plot(
            ltv_by_channel.index,
            ltv_by_channel[channel],
            marker='o',
            label=channel
        )
    
    plt.xlabel('Days Since Install')
    plt.ylabel('Cumulative ARPU ($)')
    plt.title('LTV by Channel')
    plt.legend()
    plt.grid(True, alpha=0.3)
    plt.savefig('channel_ltv.png')
    
    return ltv_by_channel
```

---

## SKAdNetwork æ•°æ®åˆ†æ

### SKAN æ•°æ®ç‰¹ç‚¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SKAN æ•°æ®åˆ†æè¦ç‚¹                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   æ•°æ®ç‰¹ç‚¹ï¼š                                                                  â”‚
â”‚   â€¢ å»¶è¿Ÿï¼šPostback å»¶è¿Ÿ 24-48 å°æ—¶                                           â”‚
â”‚   â€¢ èšåˆï¼šæ•°æ®æŒ‰ Campaign ç²’åº¦èšåˆï¼Œæ— ç”¨æˆ·çº§æ˜ç»†                                â”‚
â”‚   â€¢ ç¼ºå¤±ï¼šéšç§é˜ˆå€¼å¯¼è‡´éƒ¨åˆ†æ•°æ®ä¸º null                                         â”‚
â”‚   â€¢ æœ‰é™ï¼šä»… 64 ä¸ª CV å€¼ï¼ˆ0-63ï¼‰ç¼–ç ç”¨æˆ·è¡Œä¸º                                   â”‚
â”‚                                                                             â”‚
â”‚   åˆ†æç­–ç•¥ï¼š                                                                  â”‚
â”‚   1. CV è§£ç ï¼šå°† CV å€¼æ˜ å°„å›ä¸šåŠ¡æŒ‡æ ‡ï¼ˆæ”¶å…¥ã€äº‹ä»¶ï¼‰                              â”‚
â”‚   2. æ¯”è¾ƒåˆ†æï¼šSKAN æ•°æ® vs ä¼ ç»Ÿå½’å› æ•°æ®                                       â”‚
â”‚   3. Null CV å¤„ç†ï¼šåˆ†æ Null CV æ¯”ä¾‹ï¼Œè¯„ä¼°æ•°æ®è´¨é‡                             â”‚
â”‚   4. æ¸ é“è¯„ä¼°ï¼šåŸºäºæœ‰é™æ•°æ®åšæ¸ é“ ROI ä¼°ç®—                                      â”‚
â”‚                                                                             â”‚
â”‚   SKAN 4.0 æ–°æœºä¼šï¼š                                                          â”‚
â”‚   â€¢ å¤šæ¬¡ Postbackï¼ˆ3 æ¬¡çª—å£ï¼‰                                                â”‚
â”‚   â€¢ ç»†ç²’åº¦ + ç²—ç²’åº¦ CV                                                       â”‚
â”‚   â€¢ æ›´å¤šæ¥æºæ ‡è¯†ç¬¦                                                           â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SKAN æ•°æ®åˆ†æä»£ç 

```python
import pandas as pd
import numpy as np

def decode_conversion_value(cv, cv_mapping):
    """
    è§£ç  Conversion Value
    
    cv_mapping: dict, å¦‚ {
        0: {'revenue': 0, 'event': 'install_only'},
        1: {'revenue': 1, 'event': 'registration'},
        ...
    }
    """
    if cv is None or np.isnan(cv):
        return {'revenue': None, 'event': 'null_cv'}
    
    return cv_mapping.get(int(cv), {'revenue': None, 'event': 'unknown'})


def analyze_skan_data(skan_df, cv_mapping):
    """
    åˆ†æ SKAN æ•°æ®
    
    skan_df: DataFrame with columns:
        - date
        - media_source
        - campaign
        - installs
        - conversion_value
    """
    
    # è§£ç  CV
    skan_df['decoded'] = skan_df['conversion_value'].apply(
        lambda cv: decode_conversion_value(cv, cv_mapping)
    )
    skan_df['decoded_revenue'] = skan_df['decoded'].apply(lambda x: x['revenue'])
    skan_df['decoded_event'] = skan_df['decoded'].apply(lambda x: x['event'])
    
    # è®¡ç®— Null CV æ¯”ä¾‹
    null_cv_rate = (skan_df['conversion_value'].isna().sum() / 
                   len(skan_df))
    print(f"Null CV Rate: {null_cv_rate:.1%}")
    
    # æŒ‰æ¸ é“æ±‡æ€»
    channel_summary = skan_df.groupby('media_source').agg({
        'installs': 'sum',
        'decoded_revenue': 'sum'
    })
    channel_summary['arpu'] = (channel_summary['decoded_revenue'] / 
                               channel_summary['installs'])
    
    return channel_summary


def compare_skan_vs_traditional(skan_data, traditional_data):
    """
    å¯¹æ¯” SKAN æ•°æ®ä¸ä¼ ç»Ÿå½’å› æ•°æ®
    """
    
    comparison = pd.merge(
        skan_data[['media_source', 'installs', 'decoded_revenue']].rename(
            columns={'installs': 'skan_installs', 'decoded_revenue': 'skan_revenue'}
        ),
        traditional_data[['media_source', 'installs', 'revenue']].rename(
            columns={'installs': 'trad_installs', 'revenue': 'trad_revenue'}
        ),
        on='media_source',
        how='outer'
    )
    
    # è®¡ç®—å·®å¼‚
    comparison['install_diff'] = (
        (comparison['skan_installs'] - comparison['trad_installs']) / 
        comparison['trad_installs']
    )
    comparison['revenue_diff'] = (
        (comparison['skan_revenue'] - comparison['trad_revenue']) / 
        comparison['trad_revenue']
    )
    
    return comparison
```

---

## åä½œå¼Šæ•°æ®åˆ†æ

### ä½œå¼Šç±»å‹è¯†åˆ«

| ä½œå¼Šç±»å‹ | è¡¨ç°ç‰¹å¾ | æ£€æµ‹æ–¹æ³• |
|---------|---------|---------|
| **è®¾å¤‡å†œåœº** | å¤§é‡æ–°è®¾å¤‡ã€ç›¸åŒ IP æ®µ | è®¾å¤‡ ID èšç±»ã€IP åˆ†æ |
| **ç‚¹å‡»æ³¨å…¥** | ç‚¹å‡»åˆ°å®‰è£…æ—¶é—´æçŸ­ | CTIT åˆ†å¸ƒåˆ†æ |
| **ç‚¹å‡»æ¬ºè¯ˆ** | å¼‚å¸¸é«˜ç‚¹å‡»é‡ã€ä½ CVR | ç‚¹å‡»é‡å¼‚å¸¸æ£€æµ‹ |
| **SDK æ¬ºéª—** | è¯·æ±‚æ¨¡å¼å¼‚å¸¸ | è¯·æ±‚ç­¾åéªŒè¯ |
| **å®‰è£…åŠ«æŒ** | æœ€åä¸€è·³å¼‚å¸¸ | å½’å› è·¯å¾„åˆ†æ |

### åä½œå¼Šç›‘æ§ä»£ç 

```python
import pandas as pd
import numpy as np

def analyze_fraud_data(installs_df):
    """
    åˆ†æä½œå¼Šæ•°æ®
    
    installs_df: DataFrame with columns:
        - appsflyer_id
        - media_source
        - install_time
        - click_time
        - is_blocked
        - blocked_reason
        - blocked_sub_reason
    """
    
    # è®¡ç®—å„æ¸ é“ä½œå¼Šç‡
    fraud_by_channel = installs_df.groupby('media_source').agg({
        'appsflyer_id': 'count',
        'is_blocked': 'sum'
    }).rename(columns={
        'appsflyer_id': 'total_installs',
        'is_blocked': 'blocked_installs'
    })
    
    fraud_by_channel['fraud_rate'] = (
        fraud_by_channel['blocked_installs'] / 
        fraud_by_channel['total_installs']
    )
    
    # ä½œå¼Šç±»å‹åˆ†å¸ƒ
    fraud_types = installs_df[installs_df['is_blocked'] == True].groupby(
        'blocked_reason'
    ).size().sort_values(ascending=False)
    
    return fraud_by_channel, fraud_types


def analyze_ctit(installs_df):
    """
    åˆ†æ Click-to-Install Time (CTIT) åˆ†å¸ƒ
    æ£€æµ‹ç‚¹å‡»æ³¨å…¥ç­‰å¼‚å¸¸
    """
    
    df = installs_df.copy()
    df['ctit_seconds'] = (
        pd.to_datetime(df['install_time']) - 
        pd.to_datetime(df['click_time'])
    ).dt.total_seconds()
    
    # æŒ‰æ¸ é“ç»Ÿè®¡ CTIT åˆ†å¸ƒ
    ctit_stats = df.groupby('media_source').agg({
        'ctit_seconds': ['mean', 'median', 'std', 'min']
    })
    
    # æ ‡è®°å¼‚å¸¸ï¼ˆCTIT < 10ç§’å¯èƒ½æ˜¯ç‚¹å‡»æ³¨å…¥ï¼‰
    ctit_stats['suspicious_ratio'] = df.groupby('media_source').apply(
        lambda x: (x['ctit_seconds'] < 10).sum() / len(x)
    )
    
    return ctit_stats
```

---

## æ•°æ®ä»“åº“é›†æˆæ–¹æ¡ˆ

### æ¨èæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®ä»“åº“é›†æˆæ¶æ„                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                          â”‚
â”‚   â”‚  AppsFlyer  â”‚                                                          â”‚
â”‚   â”‚  Data Lockerâ”‚ â”€â”€â”€â”€â”€â”€â–¶ S3/GCS Bucket â”€â”€â”€â”€â”€â”€â–¶ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         (Parquet)              â”‚  æ•°æ®ä»“åº“       â”‚         â”‚
â”‚                                                  â”‚  (Snowflake/   â”‚         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚   BigQuery)    â”‚         â”‚
â”‚   â”‚  ä¸šåŠ¡æ•°æ®åº“  â”‚ â”€â”€â”€â”€â”€â”€â–¶ ETL Pipeline â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                â”‚         â”‚
â”‚   â”‚  (è®¢å•/ç”¨æˆ·) â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚                  â”‚
â”‚                                                         â”‚                  â”‚
â”‚                                                         â–¼                  â”‚
â”‚                                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚                                                  â”‚  BI æŠ¥è¡¨ç³»ç»Ÿ   â”‚         â”‚
â”‚                                                  â”‚  (Tableau/     â”‚         â”‚
â”‚                                                  â”‚   Looker)      â”‚         â”‚
â”‚                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒè¡¨è®¾è®¡

```sql
-- å®‰è£…æ˜ç»†è¡¨
CREATE TABLE fact_installs (
    install_id VARCHAR(64) PRIMARY KEY,
    appsflyer_id VARCHAR(64),
    customer_user_id VARCHAR(64),
    install_time TIMESTAMP,
    media_source VARCHAR(128),
    campaign VARCHAR(256),
    adset VARCHAR(256),
    ad VARCHAR(256),
    country_code VARCHAR(8),
    platform VARCHAR(16),
    device_type VARCHAR(64),
    cost DECIMAL(10,4),
    is_organic BOOLEAN,
    is_blocked BOOLEAN,
    blocked_reason VARCHAR(64)
);

-- äº‹ä»¶æ˜ç»†è¡¨
CREATE TABLE fact_events (
    event_id VARCHAR(64) PRIMARY KEY,
    appsflyer_id VARCHAR(64),
    customer_user_id VARCHAR(64),
    event_time TIMESTAMP,
    event_name VARCHAR(128),
    event_value JSON,
    event_revenue DECIMAL(10,4),
    event_currency VARCHAR(8),
    install_id VARCHAR(64) REFERENCES fact_installs(install_id)
);

-- æ—¥åº¦æ±‡æ€»è¡¨
CREATE TABLE agg_daily_performance (
    date DATE,
    media_source VARCHAR(128),
    campaign VARCHAR(256),
    country_code VARCHAR(8),
    platform VARCHAR(16),
    impressions INTEGER,
    clicks INTEGER,
    installs INTEGER,
    cost DECIMAL(12,4),
    d0_revenue DECIMAL(12,4),
    d1_revenue DECIMAL(12,4),
    d7_revenue DECIMAL(12,4),
    d30_revenue DECIMAL(12,4),
    d1_retention_rate DECIMAL(5,4),
    d7_retention_rate DECIMAL(5,4),
    PRIMARY KEY (date, media_source, campaign, country_code, platform)
);
```

### ETL ç¤ºä¾‹

```python
import pandas as pd
from datetime import datetime, timedelta

def load_data_locker_to_warehouse(bucket_path, date, data_type='installs'):
    """
    ä» Data Locker åŠ è½½æ•°æ®åˆ°æ•°æ®ä»“åº“
    """
    
    # è¯»å– Parquet æ–‡ä»¶
    file_path = f"{bucket_path}/{data_type}/dt={date}/*.parquet"
    df = pd.read_parquet(file_path)
    
    # æ•°æ®æ¸…æ´—
    df = clean_appsflyer_data(df)
    
    # å†™å…¥æ•°æ®ä»“åº“
    df.to_sql(
        f'fact_{data_type}',
        engine,
        if_exists='append',
        index=False
    )
    
    return len(df)


def build_daily_aggregation(date):
    """
    æ„å»ºæ—¥åº¦æ±‡æ€»æ•°æ®
    """
    
    query = f"""
    INSERT INTO agg_daily_performance
    SELECT 
        DATE(install_time) as date,
        media_source,
        campaign,
        country_code,
        platform,
        COUNT(DISTINCT install_id) as installs,
        SUM(cost) as cost,
        SUM(CASE WHEN DATEDIFF(day, install_time, event_time) <= 0 
            THEN event_revenue ELSE 0 END) as d0_revenue,
        SUM(CASE WHEN DATEDIFF(day, install_time, event_time) <= 1 
            THEN event_revenue ELSE 0 END) as d1_revenue,
        SUM(CASE WHEN DATEDIFF(day, install_time, event_time) <= 7 
            THEN event_revenue ELSE 0 END) as d7_revenue
    FROM fact_installs i
    LEFT JOIN fact_events e ON i.appsflyer_id = e.appsflyer_id
    WHERE DATE(install_time) = '{date}'
    GROUP BY 1, 2, 3, 4, 5
    """
    
    execute_query(query)
```

---

## ğŸ“š å‚è€ƒèµ„æº

- [AppsFlyer Help Center](https://support.appsflyer.com/)
- [AppsFlyer API Documentation](https://dev.appsflyer.com/)
- [SKAdNetwork Documentation](https://support.appsflyer.com/hc/en-us/articles/360011451778)
- [Protect360 Documentation](https://support.appsflyer.com/hc/en-us/articles/360000429997)

---

## âš ï¸ æ³¨æ„äº‹é¡¹

- æ‰€æœ‰ API è°ƒç”¨å¿…é¡»ä½¿ç”¨ **V2 Token**ï¼ˆJWT Bearer è®¤è¯ï¼‰ï¼ŒV1 Token å·²äº 2023å¹´9æœˆåœç”¨
- æ•°æ®åˆ†æä»£ç ä¸­çš„ API è°ƒç”¨è¯·å‚è€ƒ `APPSFLYER_API_CAPABILITIES.md` ä¸­çš„æœ€æ–°ç¤ºä¾‹

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.1 | æœ€åæ›´æ–°ï¼š2025-01*

