# ğŸ”Œ AppsFlyer API èƒ½åŠ›å…¨æ™¯åˆ†æ

> å…¨é¢è§£æ AppsFlyer æä¾›çš„æ‰€æœ‰ API æ¥å£åŠå…¶èƒ½åŠ›è¾¹ç•Œ

---

## ğŸ“‹ ç›®å½•

1. [API ä½“ç³»æ€»è§ˆ](#api-ä½“ç³»æ€»è§ˆ)
2. [Pull APIï¼ˆä¸»åŠ¨æ‹‰å–ï¼‰](#pull-apiä¸»åŠ¨æ‹‰å–)
3. [Push API / Postbackï¼ˆå®æ—¶æ¨é€ï¼‰](#push-api--postbackå®æ—¶æ¨é€)
4. [Server-to-Server APIï¼ˆS2Sï¼‰](#server-to-server-apis2s)
5. [Data Lockerï¼ˆåŸå§‹æ•°æ®å¯¼å‡ºï¼‰](#data-lockeråŸå§‹æ•°æ®å¯¼å‡º)
6. [Master APIï¼ˆè´¦æˆ·ç®¡ç†ï¼‰](#master-apiè´¦æˆ·ç®¡ç†)
7. [Audiences APIï¼ˆå—ä¼—ç®¡ç†ï¼‰](#audiences-apiå—ä¼—ç®¡ç†)
8. [SKAdNetwork API](#skadnetwork-api)
9. [API å¯¹æ¯”ä¸é€‰å‹å»ºè®®](#api-å¯¹æ¯”ä¸é€‰å‹å»ºè®®)

---

## API ä½“ç³»æ€»è§ˆ

AppsFlyer æä¾›å¤šç§ API è·å–å’Œç®¡ç†æ•°æ®ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       AppsFlyer API ä½“ç³»æ¶æ„                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                        æ•°æ®è·å– API                                  â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚   â”‚  â”‚  Pull API   â”‚   â”‚  Push API   â”‚   â”‚ Data Locker â”‚               â”‚   â”‚
â”‚   â”‚  â”‚  (æ‹‰å–)     â”‚   â”‚  (æ¨é€)     â”‚   â”‚  (å¯¼å‡º)     â”‚               â”‚   â”‚
â”‚   â”‚  â”‚             â”‚   â”‚             â”‚   â”‚             â”‚               â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ èšåˆæŠ¥è¡¨   â”‚   â”‚ â€¢ å®æ—¶äº‹ä»¶   â”‚   â”‚ â€¢ åŸå§‹æ•°æ®   â”‚               â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ åŸå§‹æŠ¥è¡¨   â”‚   â”‚ â€¢ Postback  â”‚   â”‚ â€¢ äº‘å­˜å‚¨     â”‚               â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ æŒ‰éœ€æ‹‰å–   â”‚   â”‚ â€¢ Webhook   â”‚   â”‚ â€¢ å¤§è§„æ¨¡     â”‚               â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                        åŠŸèƒ½ç®¡ç† API                                  â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚   â”‚  â”‚ Master API  â”‚   â”‚Audiences APIâ”‚   â”‚   S2S API   â”‚               â”‚   â”‚
â”‚   â”‚  â”‚  (ç®¡ç†)     â”‚   â”‚  (å—ä¼—)     â”‚   â”‚  (äº‹ä»¶)     â”‚               â”‚   â”‚
â”‚   â”‚  â”‚             â”‚   â”‚             â”‚   â”‚             â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ åº”ç”¨ç®¡ç†   â”‚   â”‚ â€¢ åˆ›å»ºå—ä¼—   â”‚   â”‚ â€¢ äº‹ä»¶ä¸ŠæŠ¥   â”‚               â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ åˆä½œä¼™ä¼´   â”‚   â”‚ â€¢ å¯¼å‡ºå—ä¼—   â”‚   â”‚ â€¢ æ”¶å…¥ä¸ŠæŠ¥   â”‚               â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ é…ç½®ç®¡ç†   â”‚   â”‚ â€¢ æ¨é€å¹¿å‘Š   â”‚   â”‚ â€¢ å¸è½½è¿½è¸ª   â”‚               â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Pull APIï¼ˆä¸»åŠ¨æ‹‰å–ï¼‰

### æ¦‚è¿°

Pull API å…è®¸å¹¿å‘Šä¸»ä¸»åŠ¨ä» AppsFlyer æ‹‰å–æŠ¥è¡¨æ•°æ®ï¼Œæ”¯æŒèšåˆæ•°æ®å’ŒåŸå§‹æ•°æ®ä¸¤ç§ç±»å‹ã€‚

### âš ï¸ é‡è¦ï¼šAPI V2 Token è®¤è¯ï¼ˆ2023å¹´9æœˆèµ·ï¼‰

è‡ª **2023å¹´9æœˆ18æ—¥** èµ·ï¼ŒAppsFlyer å·²å°† API V1 Token å‡çº§ä¸º **API V2 Token**ã€‚V2 Token åŸºäº JWTï¼Œéœ€è¦é€šè¿‡ HTTP Header è¿›è¡Œ Bearer è®¤è¯ï¼š

```bash
# V2 è®¤è¯æ–¹å¼ï¼ˆå½“å‰æ ‡å‡†ï¼‰
curl -H "Authorization: Bearer YOUR_V2_API_TOKEN" \
     "https://hq1.appsflyer.com/api/..."

# âŒ æ—§ç‰ˆ V1 æ–¹å¼å·²å¼ƒç”¨
# GET ...?api_token=xxx  # ä¸å†æ”¯æŒ
```

**è·å– V2 Token**ï¼šAppsFlyer Dashboard â†’ Settings â†’ API Tokens â†’ ç”Ÿæˆ V2 Token

### èšåˆæŠ¥è¡¨ APIï¼ˆAggregate Reportsï¼‰

#### 1. Performance Reportsï¼ˆæ•ˆæœæŠ¥è¡¨ï¼‰

| æŠ¥è¡¨ç±»å‹ | Endpoint | è¯´æ˜ |
|---------|----------|------|
| **Partners by Date** | `/export/partners_by_date_report/v5` | æŒ‰æ—¥æœŸÃ—æ¸ é“èšåˆ |
| **Partners Report** | `/export/partners_report/v5` | æŒ‰æ¸ é“èšåˆ |
| **Daily Report** | `/export/daily_report/v5` | æŒ‰æ—¥æœŸèšåˆ |
| **Geo Report** | `/export/geo_by_date_report/v5` | æŒ‰åœ°åŒºÃ—æ—¥æœŸèšåˆ |

**è¯·æ±‚ç¤ºä¾‹**ï¼ˆV2 Token Bearer è®¤è¯ï¼‰ï¼š

```bash
curl -H "Authorization: Bearer {V2_API_TOKEN}" \
     "https://hq1.appsflyer.com/api/agg-data/export/app/{app_id}/partners_by_date_report/v5?from=2024-01-01&to=2024-01-31&timezone=Asia%2FShanghai"
```

> **æ³¨æ„**ï¼šè‡ª 2023å¹´9æœˆèµ·ï¼Œæ‰€æœ‰ Pull API è¯·æ±‚å¿…é¡»ä½¿ç”¨ V2 Token é€šè¿‡ Header è®¤è¯ï¼ŒURL å‚æ•°æ–¹å¼å·²å¼ƒç”¨ã€‚

**è¿”å›å­—æ®µï¼ˆæ ¸å¿ƒï¼‰**ï¼š

| å­—æ®µ | è¯´æ˜ |
|-----|------|
| `date` | æ—¥æœŸ |
| `media_source` | åª’ä½“æ¥æºï¼ˆæ¸ é“ï¼‰ |
| `campaign` | å¹¿å‘Šç³»åˆ— |
| `impressions` | å±•ç¤ºæ•° |
| `clicks` | ç‚¹å‡»æ•° |
| `installs` | å®‰è£…æ•° |
| `cost` | èŠ±è´¹ |
| `revenue` | æ”¶å…¥ |
| `sessions` | ä¼šè¯æ•° |
| `loyal_users` | å¿ å®ç”¨æˆ·æ•° |

#### 2. Cohort Reportsï¼ˆç¾¤ç»„æŠ¥è¡¨ï¼‰

ç”¨äºåˆ†æç‰¹å®šæ—¶é—´å®‰è£…ç”¨æˆ·çš„åç»­è¡¨ç°ã€‚

| æŠ¥è¡¨ç±»å‹ | Endpoint | è¯´æ˜ |
|---------|----------|------|
| **Cohort API** | `/cohorts/v1/data/app/{app_id}` | Cohort æ•°æ® |
| **Unified Cohort** | `/cohorts/v1/data/app/{app_id}/unified` | ç»Ÿä¸€ Cohort |

**Cohort ç»´åº¦**ï¼š

| ç»´åº¦ | è¯´æ˜ |
|-----|------|
| `day` | ç¬¬å‡ å¤©ï¼ˆD0, D1, D3, D7, D14, D30...ï¼‰ |
| `media_source` | åª’ä½“æ¥æº |
| `campaign` | å¹¿å‘Šç³»åˆ— |
| `geo` | åœ°åŒº |

**Cohort æŒ‡æ ‡**ï¼š

| æŒ‡æ ‡ | è¯´æ˜ |
|-----|------|
| `users` | ç”¨æˆ·æ•° |
| `revenue` | æ”¶å…¥ |
| `cost` | èŠ±è´¹ |
| `roas` | å¹¿å‘ŠæŠ•èµ„å›æŠ¥ç‡ |
| `roi` | æŠ•èµ„å›æŠ¥ç‡ |
| `retention` | ç•™å­˜ç‡ |
| `sessions` | ä¼šè¯æ•° |
| `ecpi` | æœ‰æ•ˆ CPI |

**è¯·æ±‚ç¤ºä¾‹**ï¼š

```bash
POST https://hq1.appsflyer.com/cohorts/v1/data/app/{app_id}
Content-Type: application/json
Authorization: Bearer {api_token}

{
  "cohort_type": "user_acquisition",
  "min_cohort_size": 1,
  "cohort_day": [0, 1, 3, 7, 14, 30],
  "from": "2024-01-01",
  "to": "2024-01-31",
  "groupings": ["media_source", "campaign"],
  "kpis": ["users", "revenue", "roas", "retention"]
}
```

#### 3. Protect360 Reportsï¼ˆåä½œå¼ŠæŠ¥è¡¨ï¼‰

| æŠ¥è¡¨ç±»å‹ | è¯´æ˜ |
|---------|------|
| **Fraud Summary** | ä½œå¼Šæ±‡æ€» |
| **Blocked Installs** | è¢«å±è”½å®‰è£… |
| **Post-Attribution Fraud** | å½’å› åè¯†åˆ«çš„ä½œå¼Š |

### åŸå§‹æ•°æ®æŠ¥è¡¨ APIï¼ˆRaw Data Reportsï¼‰

#### æ”¯æŒçš„åŸå§‹æ•°æ®ç±»å‹

| æ•°æ®ç±»å‹ | Endpoint | è¯´æ˜ |
|---------|----------|------|
| **Installs** | `/export/installs_report/v5` | å®‰è£…åŸå§‹æ•°æ® |
| **In-App Events** | `/export/in_app_events_report/v5` | åº”ç”¨å†…äº‹ä»¶ |
| **Uninstalls** | `/export/uninstall_events_report/v5` | å¸è½½äº‹ä»¶ |
| **Re-Attribution** | `/export/retargeting_conversion_report/v5` | å†å½’å›  |
| **Re-Engagement** | `/export/retargeting_in_app_events_report/v5` | å†æ¿€æ´»äº‹ä»¶ |

**åŸå§‹æ•°æ®æ ¸å¿ƒå­—æ®µ**ï¼š

| å­—æ®µåˆ†ç±» | å­—æ®µç¤ºä¾‹ | è¯´æ˜ |
|---------|---------|------|
| **å½’å› ** | `media_source`, `campaign`, `adset`, `ad` | å¹¿å‘Šå±‚çº§ |
| **ç”¨æˆ·** | `appsflyer_id`, `customer_user_id`, `idfa/gaid` | ç”¨æˆ·æ ‡è¯† |
| **è®¾å¤‡** | `platform`, `device_type`, `os_version` | è®¾å¤‡ä¿¡æ¯ |
| **åœ°ç†** | `country_code`, `city`, `ip` | åœ°ç†ä½ç½® |
| **æ—¶é—´** | `install_time`, `event_time`, `click_time` | æ—¶é—´æˆ³ |
| **äº‹ä»¶** | `event_name`, `event_value`, `event_revenue` | äº‹ä»¶è¯¦æƒ… |
| **åä½œå¼Š** | `is_blocked`, `blocked_reason`, `blocked_sub_reason` | ä½œå¼Šæ ‡è¯† |

**è¯·æ±‚ç¤ºä¾‹**ï¼ˆV2 Token Bearer è®¤è¯ï¼‰ï¼š

```bash
curl -H "Authorization: Bearer {V2_API_TOKEN}" \
     "https://hq1.appsflyer.com/api/raw-data/export/app/{app_id}/in_app_events_report/v5?from=2024-01-01&to=2024-01-31&event_name=af_purchase&additional_fields=device_category,keyword_id"
```

### Pull API é™åˆ¶

| é™åˆ¶é¡¹ | è¯´æ˜ |
|-------|------|
| **è°ƒç”¨é¢‘ç‡** | æ¯ App 60 æ¬¡/åˆ†é’Ÿ |
| **æ•°æ®å»¶è¿Ÿ** | èšåˆæŠ¥è¡¨ T+1ï¼ŒåŸå§‹æŠ¥è¡¨ 1-2 å°æ—¶å»¶è¿Ÿ |
| **æ—¶é—´èŒƒå›´** | å•æ¬¡æœ€å¤š 90 å¤© |
| **æ•°æ®ä¿ç•™** | åŸå§‹æ•°æ® 24 ä¸ªæœˆï¼Œèšåˆæ•°æ® 36 ä¸ªæœˆ |
| **è¡Œæ•°é™åˆ¶** | å•æ¬¡æœ€å¤š 100 ä¸‡è¡Œï¼ˆè¶…è¿‡éœ€åˆ†é¡µæˆ–ä½¿ç”¨ Data Lockerï¼‰ |

---

## Push API / Postbackï¼ˆå®æ—¶æ¨é€ï¼‰

### æ¦‚è¿°

Push API å…è®¸ AppsFlyer åœ¨äº‹ä»¶å‘ç”Ÿæ—¶å®æ—¶æ¨é€æ•°æ®åˆ°å¹¿å‘Šä¸»æŒ‡å®šçš„æœåŠ¡å™¨ã€‚

### Postback ç±»å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Postback æ•°æ®æµå‘                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ç”¨æˆ·è¡Œä¸º                  AppsFlyer                  ç›®æ ‡æœåŠ¡å™¨             â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚ å®‰è£…    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚ å½’å›     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚ å¹¿å‘Šä¸»   â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ æœåŠ¡å™¨   â”‚            â”‚
â”‚                                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚                 â”‚
â”‚   â”‚ äº‹ä»¶    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚ äº‹ä»¶    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚                                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ å¹¿å‘Šå¹³å°  â”‚            â”‚
â”‚   â”‚ ä»˜è´¹    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚ æ”¶å…¥    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚ (Metaç­‰)  â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é…ç½® Postback

**åœ¨ AppsFlyer Dashboard ä¸­é…ç½®**ï¼š

1. è¿›å…¥ App Settings > Integrated Partners
2. é€‰æ‹©ç›®æ ‡åˆä½œä¼™ä¼´æˆ–è‡ªå®šä¹‰ç«¯ç‚¹
3. é…ç½®è§¦å‘äº‹ä»¶å’Œ Postback URL

**è‡ªå®šä¹‰ Postback URL ç¤ºä¾‹**ï¼š

```
https://your-server.com/postback?event={event_name}&install_time={install_time}&media_source={media_source}&campaign={campaign}&af_id={appsflyer_id}&revenue={event_revenue}
```

### å¯ç”¨ Postback å®

| å® | è¯´æ˜ |
|---|------|
| `{event_name}` | äº‹ä»¶åç§° |
| `{event_time}` | äº‹ä»¶æ—¶é—´ |
| `{event_value}` | äº‹ä»¶å€¼ï¼ˆJSONï¼‰ |
| `{event_revenue}` | äº‹ä»¶æ”¶å…¥ |
| `{event_revenue_currency}` | æ”¶å…¥å¸ç§ |
| `{appsflyer_id}` | AppsFlyer ID |
| `{customer_user_id}` | å®¢æˆ·ç”¨æˆ·ID |
| `{idfa}` | iOS IDFA |
| `{advertising_id}` | Android GAID |
| `{media_source}` | åª’ä½“æ¥æº |
| `{campaign}` | å¹¿å‘Šç³»åˆ— |
| `{campaign_id}` | å¹¿å‘Šç³»åˆ—ID |
| `{adset}` | å¹¿å‘Šç»„ |
| `{adset_id}` | å¹¿å‘Šç»„ID |
| `{ad}` | å¹¿å‘Š |
| `{ad_id}` | å¹¿å‘ŠID |
| `{country_code}` | å›½å®¶ä»£ç  |
| `{city}` | åŸå¸‚ |
| `{install_time}` | å®‰è£…æ—¶é—´ |
| `{click_time}` | ç‚¹å‡»æ—¶é—´ |
| `{platform}` | å¹³å° |
| `{device_type}` | è®¾å¤‡ç±»å‹ |
| `{is_retargeting}` | æ˜¯å¦å†è¥é”€ |

### Postback è§¦å‘æ¡ä»¶

| äº‹ä»¶ç±»å‹ | å¯é…ç½®æ¡ä»¶ |
|---------|-----------|
| **Install** | æ–°å®‰è£…ã€é‡è£… |
| **In-App Event** | æŒ‡å®šäº‹ä»¶åç§° |
| **Revenue Event** | åŒ…å«æ”¶å…¥çš„äº‹ä»¶ |
| **Re-Attribution** | å†å½’å›  |
| **Re-Engagement** | å†æ¿€æ´» |

---

## Server-to-Server APIï¼ˆS2Sï¼‰

### æ¦‚è¿°

S2S API å…è®¸ä»åç«¯æœåŠ¡å™¨ç›´æ¥å‘ AppsFlyer å‘é€æ•°æ®ï¼Œé€‚ç”¨äºï¼š
- æ— æ³•é€šè¿‡ SDK ä¸ŠæŠ¥çš„äº‹ä»¶ï¼ˆå¦‚åç«¯éªŒè¯çš„ä»˜è´¹ï¼‰
- åç«¯å‘ç”Ÿçš„ä¸šåŠ¡äº‹ä»¶
- æ•°æ®è¡¥ä¼ å’Œä¿®æ­£

### S2S Event API

**Endpoint**ï¼š

```
POST https://api2.appsflyer.com/inappevent/{app_id}
```

**è¯·æ±‚æ ¼å¼**ï¼š

```json
{
  "appsflyer_id": "1234567890123-1234567890123456789",
  "customer_user_id": "user_123",
  "eventName": "af_purchase",
  "eventValue": "{\"af_revenue\": 99.99, \"af_currency\": \"USD\", \"af_order_id\": \"order_456\"}",
  "eventCurrency": "USD",
  "eventTime": "2024-01-15 10:30:00.000",
  "af_events_api": "true"
}
```

**å…³é”®å‚æ•°**ï¼š

| å‚æ•° | å¿…å¡« | è¯´æ˜ |
|-----|-----|------|
| `appsflyer_id` | æ˜¯ | AppsFlyer è®¾å¤‡ID |
| `eventName` | æ˜¯ | äº‹ä»¶åç§° |
| `eventValue` | å¦ | äº‹ä»¶å€¼ï¼ˆJSON å­—ç¬¦ä¸²ï¼‰ |
| `eventCurrency` | å¦ | æ”¶å…¥å¸ç§ |
| `eventTime` | å¦ | äº‹ä»¶æ—¶é—´ï¼ˆUTCï¼‰ |
| `customer_user_id` | å¦ | å®¢æˆ·ç”¨æˆ·ID |
| `ip` | å¦ | ç”¨æˆ· IP |

### S2S Install API

ç”¨äºåç«¯ä¸ŠæŠ¥å®‰è£…ï¼ˆé€‚ç”¨äºæ—  SDK åœºæ™¯ï¼‰ï¼š

```
POST https://api2.appsflyer.com/installs/{app_id}
```

### S2S API æ³¨æ„äº‹é¡¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        S2S API ä½¿ç”¨è¦ç‚¹                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  âœ… æ¨èåœºæ™¯ï¼š                                                               â”‚
â”‚     â€¢ åç«¯éªŒè¯çš„ä»˜è´¹äº‹ä»¶ï¼ˆé˜²æ­¢å®¢æˆ·ç«¯ç¯¡æ”¹ï¼‰                                      â”‚
â”‚     â€¢ è®¢é˜…ç±»äº§å“çš„ç»­è´¹äº‹ä»¶                                                    â”‚
â”‚     â€¢ CRM ç³»ç»Ÿçš„ç”¨æˆ·æ ‡ç­¾æ›´æ–°                                                  â”‚
â”‚     â€¢ ç¦»çº¿è½¬åŒ–æ•°æ®å›ä¼                                                         â”‚
â”‚                                                                             â”‚
â”‚  âš ï¸ æ³¨æ„äº‹é¡¹ï¼š                                                               â”‚
â”‚     â€¢ å¿…é¡»æœ‰ appsflyer_idï¼ˆä» SDK è·å–å¹¶å­˜å‚¨ï¼‰                                 â”‚
â”‚     â€¢ äº‹ä»¶æ—¶é—´ä¸èƒ½è¶…è¿‡å½“å‰æ—¶é—´ 24 å°æ—¶å‰                                        â”‚
â”‚     â€¢ æ”¶å…¥äº‹ä»¶ä¼šå½±å“ LTV å’Œ ROAS è®¡ç®—                                          â”‚
â”‚     â€¢ é¢‘ç‡é™åˆ¶ï¼šæ¯ App æ¯åˆ†é’Ÿ 60,000 æ¬¡                                        â”‚
â”‚                                                                             â”‚
â”‚  âŒ ä¸é€‚ç”¨åœºæ™¯ï¼š                                                              â”‚
â”‚     â€¢ èƒ½é€šè¿‡ SDK ä¸ŠæŠ¥çš„äº‹ä»¶ï¼ˆä¼šé€ æˆé‡å¤ï¼‰                                       â”‚
â”‚     â€¢ æ— æ³•è·å– appsflyer_id çš„ç”¨æˆ·                                            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Lockerï¼ˆåŸå§‹æ•°æ®å¯¼å‡ºï¼‰

### æ¦‚è¿°

Data Locker æ˜¯ AppsFlyer çš„å¤§è§„æ¨¡åŸå§‹æ•°æ®å¯¼å‡ºæ–¹æ¡ˆï¼Œå°†æ•°æ®ç›´æ¥å†™å…¥äº‘å­˜å‚¨ï¼ˆAWS S3ã€GCSã€Azure Blob ç­‰ï¼‰ã€‚

### æ•°æ®ç±»å‹

| æ•°æ®ç±»å‹ | è¯´æ˜ | å»¶è¿Ÿ |
|---------|------|------|
| **Installs** | å®‰è£…æ•°æ® | å°æ—¶çº§ |
| **In-App Events** | åº”ç”¨å†…äº‹ä»¶ | å°æ—¶çº§ |
| **Sessions** | ä¼šè¯æ•°æ® | å°æ—¶çº§ |
| **Uninstalls** | å¸è½½æ•°æ® | æ—¥çº§ |
| **Re-Attributions** | å†å½’å› æ•°æ® | å°æ—¶çº§ |
| **Ad Revenue** | å¹¿å‘Šå˜ç°æ”¶å…¥ | å°æ—¶çº§ |
| **Protect360** | åä½œå¼Šæ•°æ® | å°æ—¶çº§ |
| **SKAN Postbacks** | SKAdNetwork å›ä¼  | æ—¥çº§ |

### æ–‡ä»¶æ ¼å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Data Locker æ–‡ä»¶ç»“æ„                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   bucket-name/                                                              â”‚
â”‚   â””â”€â”€ data-locker-hourly/                                                   â”‚
â”‚       â””â”€â”€ {data_type}/                                                      â”‚
â”‚           â””â”€â”€ dt={date}/                                                    â”‚
â”‚               â””â”€â”€ h={hour}/                                                 â”‚
â”‚                   â””â”€â”€ part-00000-xxx.parquet                                â”‚
â”‚                                                                             â”‚
â”‚   ç¤ºä¾‹ï¼š                                                                     â”‚
â”‚   s3://my-bucket/data-locker-hourly/installs/dt=2024-01-15/h=10/            â”‚
â”‚       â””â”€â”€ part-00000-abc123.parquet                                         â”‚
â”‚                                                                             â”‚
â”‚   æ”¯æŒæ ¼å¼ï¼š                                                                 â”‚
â”‚   â€¢ Parquetï¼ˆæ¨èï¼Œå‹ç¼©æ•ˆç‡é«˜ï¼‰                                               â”‚
â”‚   â€¢ CSV                                                                     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Data Locker vs Pull API

| å¯¹æ¯”é¡¹ | Data Locker | Pull API |
|-------|-------------|----------|
| **æ•°æ®è§„æ¨¡** | æ— é™åˆ¶ | å•æ¬¡ 100 ä¸‡è¡Œ |
| **å»¶è¿Ÿ** | å°æ—¶çº§ | 1-2 å°æ—¶ |
| **æ ¼å¼** | Parquet/CSV | CSV |
| **å­˜å‚¨** | å®¢æˆ·äº‘å­˜å‚¨ | AppsFlyer æœåŠ¡å™¨ |
| **é€‚ç”¨åœºæ™¯** | æ•°æ®ä»“åº“ã€å¤§è§„æ¨¡åˆ†æ | å°è§„æ¨¡æŸ¥è¯¢ã€ä¸´æ—¶æŠ¥è¡¨ |
| **è´¹ç”¨** | éœ€å¼€é€šï¼Œå¯èƒ½é¢å¤–æ”¶è´¹ | åŸºç¡€åŠŸèƒ½ |

### Data Locker é…ç½®æ­¥éª¤

1. **åˆ›å»ºäº‘å­˜å‚¨ Bucket**ï¼ˆS3/GCS/Azureï¼‰
2. **é…ç½®è®¿é—®æƒé™**ï¼ˆIAM Role æˆ– Service Accountï¼‰
3. **åœ¨ AppsFlyer ä¸­é…ç½®è¿æ¥**
4. **é€‰æ‹©è¦å¯¼å‡ºçš„æ•°æ®ç±»å‹**
5. **è®¾ç½®åˆ†åŒºæ–¹å¼**ï¼ˆå°æ—¶/æ—¥ï¼‰

---

## Master APIï¼ˆè´¦æˆ·ç®¡ç†ï¼‰

### æ¦‚è¿°

Master API ç”¨äºç¨‹åºåŒ–ç®¡ç† AppsFlyer è´¦æˆ·å’Œåº”ç”¨é…ç½®ã€‚

### åŠŸèƒ½åˆ—è¡¨

| åŠŸèƒ½ | Endpoint | è¯´æ˜ |
|-----|----------|------|
| **è·å–åº”ç”¨åˆ—è¡¨** | `GET /apps` | è·å–è´¦æˆ·ä¸‹æ‰€æœ‰åº”ç”¨ |
| **åˆ›å»ºåº”ç”¨** | `POST /apps` | åˆ›å»ºæ–°åº”ç”¨ |
| **æ›´æ–°åº”ç”¨è®¾ç½®** | `PUT /apps/{app_id}` | æ›´æ–°åº”ç”¨é…ç½® |
| **è·å–åˆä½œä¼™ä¼´** | `GET /partners` | è·å–é›†æˆçš„åˆä½œä¼™ä¼´ |
| **ç®¡ç† Postback** | `POST /partners/{partner}/postbacks` | é…ç½® Postback |

### åº”ç”¨ç®¡ç†ç¤ºä¾‹

**è·å–åº”ç”¨åˆ—è¡¨**ï¼š

```bash
GET https://hq1.appsflyer.com/api/mng/apps
Authorization: Bearer {api_token}
```

**å“åº”**ï¼š

```json
{
  "apps": [
    {
      "id": "com.example.app",
      "name": "My App",
      "platform": "android",
      "status": "active",
      "timezone": "Asia/Shanghai",
      "currency": "USD"
    }
  ]
}
```

---

## Audiences APIï¼ˆå—ä¼—ç®¡ç†ï¼‰

### æ¦‚è¿°

Audiences API å…è®¸åˆ›å»ºã€ç®¡ç†å’Œå¯¼å‡ºç”¨æˆ·åˆ†ç¾¤ï¼Œç”¨äºå¹¿å‘Šå¹³å°çš„å†è¥é”€ã€‚

### åŠŸèƒ½æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Audiences å·¥ä½œæµç¨‹                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚  å®šä¹‰è§„åˆ™    â”‚     â”‚  åˆ›å»ºå—ä¼—    â”‚     â”‚  å¯¼å‡ºå—ä¼—    â”‚                  â”‚
â”‚   â”‚             â”‚â”€â”€â”€â”€â–¶â”‚             â”‚â”€â”€â”€â”€â–¶â”‚             â”‚                  â”‚
â”‚   â”‚ â€¢ äº‹ä»¶æ¡ä»¶   â”‚     â”‚ â€¢ å‘½å      â”‚     â”‚ â€¢ Meta      â”‚                  â”‚
â”‚   â”‚ â€¢ æ—¶é—´èŒƒå›´   â”‚     â”‚ â€¢ æè¿°      â”‚     â”‚ â€¢ Google    â”‚                  â”‚
â”‚   â”‚ â€¢ å±æ€§ç­›é€‰   â”‚     â”‚ â€¢ ä¿å­˜      â”‚     â”‚ â€¢ TikTok    â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                             â”‚
â”‚   ç¤ºä¾‹è§„åˆ™ï¼š                                                                 â”‚
â”‚   â€¢ è¿‡å»7å¤©å†…å®‰è£…ä½†æœªä»˜è´¹çš„ç”¨æˆ·                                               â”‚
â”‚   â€¢ ä»˜è´¹è¶…è¿‡$100çš„é«˜ä»·å€¼ç”¨æˆ·                                                  â”‚
â”‚   â€¢ 30å¤©å†…æ´»è·ƒä½†æœ€è¿‘7å¤©æœªç™»å½•çš„ç”¨æˆ·                                           â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### API æ“ä½œ

| æ“ä½œ | Endpoint | è¯´æ˜ |
|-----|----------|------|
| **åˆ›å»ºå—ä¼—** | `POST /audiences` | åŸºäºè§„åˆ™åˆ›å»º |
| **è·å–å—ä¼—åˆ—è¡¨** | `GET /audiences` | åˆ—å‡ºæ‰€æœ‰å—ä¼— |
| **è·å–å—ä¼—è¯¦æƒ…** | `GET /audiences/{id}` | å—ä¼—è¯¦ç»†ä¿¡æ¯ |
| **æ›´æ–°å—ä¼—** | `PUT /audiences/{id}` | ä¿®æ”¹å—ä¼—è§„åˆ™ |
| **åˆ é™¤å—ä¼—** | `DELETE /audiences/{id}` | åˆ é™¤å—ä¼— |
| **å¯¼å‡ºå—ä¼—** | `POST /audiences/{id}/export` | å¯¼å‡ºåˆ°å¹¿å‘Šå¹³å° |

### å—ä¼—è§„åˆ™ç¤ºä¾‹

```json
{
  "name": "High Value Users - 30 Days",
  "description": "Users with revenue > $100 in last 30 days",
  "rules": {
    "type": "AND",
    "conditions": [
      {
        "type": "event",
        "event_name": "af_purchase",
        "aggregation": "sum",
        "field": "af_revenue",
        "operator": "greater_than",
        "value": 100,
        "time_range": {
          "type": "last_n_days",
          "value": 30
        }
      }
    ]
  },
  "export_destinations": [
    {
      "partner": "facebook",
      "audience_id": "123456789"
    }
  ]
}
```

---

## SKAdNetwork API

### æ¦‚è¿°

SKAdNetwork API ç”¨äºè·å–å’Œåˆ†æ Apple SKAdNetwork å½’å› æ•°æ®ã€‚

### SKAN æ•°æ®è·å–

#### Pull API è·å– SKAN æ•°æ®

```bash
curl -H "Authorization: Bearer {V2_API_TOKEN}" \
     "https://hq1.appsflyer.com/api/skadnetwork/v3/data/app/{app_id}/aggregated?start_date=2024-01-01&end_date=2024-01-31"
```

#### è¿”å›å­—æ®µ

| å­—æ®µ | è¯´æ˜ |
|-----|------|
| `date` | æ—¥æœŸ |
| `media_source` | åª’ä½“æ¥æº |
| `campaign` | å¹¿å‘Šç³»åˆ— |
| `installs` | SKAN å®‰è£…æ•° |
| `conversion_value` | è½¬åŒ–å€¼ |
| `is_null_cv` | CV æ˜¯å¦ä¸º null |
| `decoded_revenue` | è§£ç åçš„æ”¶å…¥ |
| `decoded_events` | è§£ç åçš„äº‹ä»¶ |

### Conversion Value é…ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Conversion Value é…ç½®ç­–ç•¥                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   SKAN 4.0 Conversion Value èŒƒå›´ï¼š0-63ï¼ˆ6 bitï¼‰                              â”‚
â”‚                                                                             â”‚
â”‚   å¸¸è§ç¼–ç ç­–ç•¥ï¼š                                                             â”‚
â”‚                                                                             â”‚
â”‚   ç­–ç•¥1ï¼šçº¯æ”¶å…¥åˆ†æ¡¶                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚   â”‚ CV  â”‚ æ”¶å…¥èŒƒå›´     â”‚                                                    â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                    â”‚
â”‚   â”‚ 0   â”‚ $0          â”‚                                                    â”‚
â”‚   â”‚ 1-10â”‚ $0.01-$10   â”‚                                                    â”‚
â”‚   â”‚11-30â”‚ $10-$50     â”‚                                                    â”‚
â”‚   â”‚31-50â”‚ $50-$200    â”‚                                                    â”‚
â”‚   â”‚51-63â”‚ $200+       â”‚                                                    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚
â”‚                                                                             â”‚
â”‚   ç­–ç•¥2ï¼šäº‹ä»¶+æ”¶å…¥æ··åˆç¼–ç                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚   â”‚ CV  â”‚ å«ä¹‰                     â”‚                                        â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                        â”‚
â”‚   â”‚ 0   â”‚ ä»…å®‰è£…                   â”‚                                        â”‚
â”‚   â”‚ 1-5 â”‚ å®Œæˆæ³¨å†Œï¼Œæ”¶å…¥åˆ†5æ¡£       â”‚                                        â”‚
â”‚   â”‚ 6-15â”‚ å®Œæˆæ•™ç¨‹ï¼Œæ”¶å…¥åˆ†10æ¡£      â”‚                                        â”‚
â”‚   â”‚16-63â”‚ å®Œæˆé¦–å……ï¼Œæ”¶å…¥ç²¾ç»†åˆ†æ¡£    â”‚                                        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SKAN 4.0 æ–°ç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ |
|-----|------|
| **Coarse Conversion Value** | ç²—ç²’åº¦ CVï¼ˆlow/medium/highï¼‰ |
| **Fine Conversion Value** | ç»†ç²’åº¦ CVï¼ˆ0-63ï¼‰ |
| **Lock Window** | å¤šçª—å£é”å®šï¼ˆ0-2å¤©ã€3-7å¤©ã€8-35å¤©ï¼‰ |
| **Source Identifier** | 4ä½/3ä½/2ä½æ¥æºæ ‡è¯† |
| **Crowd Anonymity** | äººç¾¤åŒ¿åç­‰çº§ |

---

## API å¯¹æ¯”ä¸é€‰å‹å»ºè®®

### æ•°æ®è·å– API å¯¹æ¯”

| åœºæ™¯ | æ¨è API | åŸå›  |
|-----|----------|------|
| **å®æ—¶å¤„ç†å®‰è£…/äº‹ä»¶** | Push API (Postback) | å®æ—¶ï¼Œæ— éœ€è½®è¯¢ |
| **æ—¥å¸¸æŠ¥è¡¨è‡ªåŠ¨åŒ–** | Pull API | ç®€å•ï¼Œé€‚åˆèšåˆåˆ†æ |
| **æ•°æ®ä»“åº“åŒæ­¥** | Data Locker | å¤§è§„æ¨¡ï¼ŒParquet é«˜æ•ˆ |
| **ä¸´æ—¶æ•°æ®æŸ¥è¯¢** | Pull API | çµæ´»ï¼ŒæŒ‰éœ€è°ƒç”¨ |
| **åç«¯äº‹ä»¶ä¸ŠæŠ¥** | S2S API | æœåŠ¡ç«¯ç›´æ¥ä¸ŠæŠ¥ |

### API é€‰å‹å†³ç­–æ ‘

```
å¼€å§‹
  â”‚
  â”œâ”€â”€ éœ€è¦å®æ—¶æ•°æ®ï¼Ÿ
  â”‚     â”œâ”€â”€ æ˜¯ â†’ Push API (Postback)
  â”‚     â””â”€â”€ å¦ â”€â”
  â”‚             â”‚
  â”‚     â”œâ”€â”€ æ•°æ®é‡å¤§ï¼ˆ>100ä¸‡/å¤©ï¼‰ï¼Ÿ
  â”‚           â”œâ”€â”€ æ˜¯ â†’ Data Locker
  â”‚           â””â”€â”€ å¦ â”€â”
  â”‚                   â”‚
  â”‚           â”œâ”€â”€ éœ€è¦åŸå§‹æ•°æ®ï¼Ÿ
  â”‚                 â”œâ”€â”€ æ˜¯ â†’ Pull API (Raw Data)
  â”‚                 â””â”€â”€ å¦ â†’ Pull API (Aggregate)
  â”‚
  â”œâ”€â”€ éœ€è¦ä¸ŠæŠ¥åç«¯äº‹ä»¶ï¼Ÿ
  â”‚     â””â”€â”€ æ˜¯ â†’ S2S API
  â”‚
  â”œâ”€â”€ éœ€è¦ç®¡ç†å—ä¼—ï¼Ÿ
  â”‚     â””â”€â”€ æ˜¯ â†’ Audiences API
  â”‚
  â””â”€â”€ éœ€è¦ç®¡ç†åº”ç”¨é…ç½®ï¼Ÿ
        â””â”€â”€ æ˜¯ â†’ Master API
```

### å…¸å‹æ•°æ®æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ¨èæ•°æ®æ¶æ„                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                      AppsFlyer                                      â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   Push API              Data Locker            Pull API             â”‚   â”‚
â”‚   â”‚   (å®æ—¶)                (æ‰¹é‡)                 (æŒ‰éœ€)               â”‚   â”‚
â”‚   â”‚      â”‚                     â”‚                      â”‚                 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚          â”‚                     â”‚                      â”‚                     â”‚
â”‚          â–¼                     â–¼                      â–¼                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â”‚  å®æ—¶å¤„ç†    â”‚       â”‚  æ•°æ®ä»“åº“    â”‚       â”‚  è¿è¥åå°    â”‚             â”‚
â”‚   â”‚  Kafka/     â”‚       â”‚  Snowflake/ â”‚       â”‚  Dashboard  â”‚             â”‚
â”‚   â”‚  Kinesis    â”‚       â”‚  BigQuery   â”‚       â”‚             â”‚             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚          â”‚                     â”‚                                          â”‚
â”‚          â”‚                     â–¼                                          â”‚
â”‚          â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   BI æŠ¥è¡¨    â”‚                                   â”‚
â”‚                         â”‚  Tableau/   â”‚                                   â”‚
â”‚                         â”‚  Looker     â”‚                                   â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“š API è°ƒç”¨ç¤ºä¾‹ä»£ç 

### Python ç¤ºä¾‹ï¼ˆV2 Token Bearer è®¤è¯ï¼‰

```python
import requests
from datetime import datetime, timedelta

class AppsFlyerAPI:
    """
    AppsFlyer API å®¢æˆ·ç«¯
    æ³¨æ„ï¼šè‡ª 2023å¹´9æœˆèµ·ï¼Œæ‰€æœ‰ API å¿…é¡»ä½¿ç”¨ V2 Tokenï¼ˆJWT Bearer è®¤è¯ï¼‰
    """
    
    def __init__(self, v2_api_token: str, app_id: str):
        """
        åˆå§‹åŒ– API å®¢æˆ·ç«¯
        
        Args:
            v2_api_token: AppsFlyer V2 API Tokenï¼ˆä» Dashboard è·å–ï¼‰
            app_id: åº”ç”¨ IDï¼ˆå¦‚ com.example.app æˆ– id123456789ï¼‰
        """
        self.api_token = v2_api_token
        self.app_id = app_id
        self.base_url = "https://hq1.appsflyer.com"
        self.headers = {
            "Authorization": f"Bearer {self.api_token}",
            "Content-Type": "application/json"
        }
    
    def get_partners_report(self, from_date: str, to_date: str, timezone: str = "UTC"):
        """
        è·å–æ¸ é“èšåˆæŠ¥è¡¨ï¼ˆV2 APIï¼‰
        
        Args:
            from_date: å¼€å§‹æ—¥æœŸ (YYYY-MM-DD)
            to_date: ç»“æŸæ—¥æœŸ (YYYY-MM-DD)
            timezone: æ—¶åŒº
        """
        endpoint = f"{self.base_url}/api/agg-data/export/app/{self.app_id}/partners_by_date_report/v5"
        params = {
            "from": from_date,
            "to": to_date,
            "timezone": timezone
        }
        response = requests.get(endpoint, headers=self.headers, params=params)
        response.raise_for_status()
        return response.text  # CSV æ ¼å¼
    
    def get_installs_raw(self, from_date: str, to_date: str, additional_fields: list = None):
        """
        è·å–å®‰è£…åŸå§‹æ•°æ®ï¼ˆV2 APIï¼‰
        """
        endpoint = f"{self.base_url}/api/raw-data/export/app/{self.app_id}/installs_report/v5"
        params = {
            "from": from_date,
            "to": to_date
        }
        if additional_fields:
            params["additional_fields"] = ",".join(additional_fields)
        response = requests.get(endpoint, headers=self.headers, params=params)
        response.raise_for_status()
        return response.text
    
    def send_s2s_event(self, appsflyer_id: str, event_name: str, 
                       event_value: dict = None, revenue: float = None, 
                       currency: str = "USD"):
        """
        S2S ä¸ŠæŠ¥äº‹ä»¶ï¼ˆäº‹ä»¶ API ä»ä½¿ç”¨ authentication headerï¼‰
        """
        endpoint = f"https://api2.appsflyer.com/inappevent/{self.app_id}"
        headers = {
            "authentication": self.api_token,  # S2S API ä½¿ç”¨æ­¤ header
            "Content-Type": "application/json"
        }
        data = {
            "appsflyer_id": appsflyer_id,
            "eventName": event_name,
            "af_events_api": "true"
        }
        if event_value:
            import json
            data["eventValue"] = json.dumps(event_value)
        if revenue is not None:
            import json
            data["eventValue"] = json.dumps({
                "af_revenue": revenue, 
                "af_currency": currency
            })
            data["eventCurrency"] = currency
        
        response = requests.post(endpoint, headers=headers, json=data)
        return response.status_code == 200, response.text
    
    def get_cohort_data(self, from_date: str, to_date: str, 
                        groupings: list, kpis: list, cohort_days: list):
        """
        è·å– Cohort æ•°æ®ï¼ˆV2 APIï¼‰
        """
        endpoint = f"{self.base_url}/api/cohorts/v1/data/app/{self.app_id}"
        data = {
            "cohort_type": "user_acquisition",
            "min_cohort_size": 1,
            "cohort_day": cohort_days,
            "from": from_date,
            "to": to_date,
            "groupings": groupings,
            "kpis": kpis
        }
        response = requests.post(endpoint, headers=self.headers, json=data)
        response.raise_for_status()
        return response.json()


# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    # âš ï¸ å¿…é¡»ä½¿ç”¨ V2 API Tokenï¼ˆä» AppsFlyer Dashboard â†’ Settings â†’ API Tokens è·å–ï¼‰
    api = AppsFlyerAPI(
        v2_api_token="your_v2_api_token_here",  # JWT æ ¼å¼çš„ V2 Token
        app_id="com.example.app"
    )
    
    # è·å–è¿‡å»7å¤©çš„æ¸ é“æŠ¥è¡¨
    from_date = (datetime.now() - timedelta(days=7)).strftime("%Y-%m-%d")
    to_date = datetime.now().strftime("%Y-%m-%d")
    
    try:
        partners_data = api.get_partners_report(from_date, to_date)
        print(partners_data)
    except requests.HTTPError as e:
        print(f"API Error: {e}")
    
    # S2S ä¸ŠæŠ¥ä»˜è´¹äº‹ä»¶
    success, response = api.send_s2s_event(
        appsflyer_id="1234567890123-1234567890123456789",
        event_name="af_purchase",
        revenue=99.99,
        currency="USD"
    )
    print(f"S2S Event: {'Success' if success else 'Failed'} - {response}")
```

---

## ğŸ”— å‚è€ƒèµ„æº

- [AppsFlyer Dev Hub](https://dev.appsflyer.com/)
- [Pull API Documentation](https://support.appsflyer.com/hc/en-us/articles/207034346)
- [Push API Documentation](https://support.appsflyer.com/hc/en-us/articles/207033936)
- [S2S API Documentation](https://support.appsflyer.com/hc/en-us/articles/207034486)
- [Data Locker Documentation](https://support.appsflyer.com/hc/en-us/articles/360000726397)
- [SKAdNetwork Documentation](https://support.appsflyer.com/hc/en-us/articles/360011815357)

---

## âš ï¸ é‡è¦å˜æ›´è®°å½•

| æ—¥æœŸ | å˜æ›´å†…å®¹ |
|-----|---------|
| 2023-09-18 | API V1 Token åœç”¨ï¼Œæ‰€æœ‰ API å¿…é¡»ä½¿ç”¨ V2 Tokenï¼ˆJWT Bearer è®¤è¯ï¼‰ |
| 2024-04-07 | iOS SDK éœ€è¦æ”¯æŒ Privacy Manifest |
| 2024-07 | iOS SDK 6.14.6 å‘å¸ƒ |
| 2025-07 | Android SDK 6.17.1 å‘å¸ƒï¼Œæ–°å¢ Google Play Integrity API æ”¯æŒ |

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.1 | æœ€åæ›´æ–°ï¼š2025-01ï¼ˆå·²æ›´æ–°è‡³ V2 Token è®¤è¯ï¼‰*

