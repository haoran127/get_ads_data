# 📖 程序化交易广告

> RTB、ADX、DSP、SSP 全解析

---

## 🎯 什么是程序化交易？

**程序化交易**（Programmatic Trading）是指通过**机器自动化**的方式完成广告的买卖，核心特点是**实时竞价（RTB）**。

### **程序化交易的演进**

```
广告交易方式演进：

合约广告 ──▶ 竞价广告网络 ──▶ 程序化交易
   │              │               │
 预先约定      固定标签竞价     逐次展示实时竞价
 人工谈判      半自动化          全自动化
 量的保证      无量保证          无量保证
```

### **程序化交易的核心价值**

| 价值 | 说明 |
|-----|------|
| **精准定向** | 可以使用定制化的用户标签 |
| **实时优化** | 每次展示都可以独立决策 |
| **数据驱动** | 第一方、第三方数据充分利用 |
| **效率提升** | 机器自动完成大量决策 |

---

## 🔄 RTB（实时竞价）

### **RTB 是什么？**

**RTB**（Real-Time Bidding）是指在**每次广告展示机会**出现时，通过**实时竞价**的方式决定由哪个广告主获得这次展示。

### **RTB 流程**

```
┌─────────────────────────────────────────────────────────────────┐
│                      RTB 竞价流程                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ① 用户访问页面                                                 │
│         │                                                       │
│         ▼                                                       │
│   ② 媒体向ADX发送广告请求                                         │
│         │                                                       │
│         ▼                                                       │
│   ③ ADX向多个DSP发送竞价请求                                      │
│         │                                                       │
│         │    ┌────────────────────────────────┐                │
│         │    │  竞价请求包含：                  │                │
│         │    │  • 用户ID (Cookie/DeviceID)    │                │
│         │    │  • 页面URL                     │                │
│         │    │  • 广告位信息                   │                │
│         │    │  • 用户画像（可选）             │                │
│         │    └────────────────────────────────┘                │
│         │                                                       │
│         ▼                                                       │
│   ④ DSP 计算出价并返回                                           │
│         │    （通常需要在100ms内完成）                            │
│         │                                                       │
│         ▼                                                       │
│   ⑤ ADX 选择最高出价者                                           │
│         │                                                       │
│         ▼                                                       │
│   ⑥ 展示获胜DSP的广告                                            │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘

整个过程在 100-150ms 内完成！
```

### **RTB 的时间要求**

```
时间线（总计约100ms）：

0ms      ─── 广告请求发出
  │
10ms     ─── ADX 收到请求
  │
15ms     ─── ADX 向 DSP 发送竞价请求
  │
70ms     ─── DSP 必须返回出价（约55ms决策时间）
  │
80ms     ─── ADX 完成比价
  │
100ms    ─── 广告返回给页面展示

超时的DSP出价将被忽略！
```

---

## 🏛️ 程序化交易生态

### **核心角色**

```
┌─────────────────────────────────────────────────────────────────┐
│                    程序化交易生态系统                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   需求方                    交易平台                 供给方       │
│                                                                 │
│  ┌─────────┐              ┌─────────┐           ┌─────────┐   │
│  │ 广告主   │              │         │           │  媒体    │   │
│  └────┬────┘              │   ADX   │           └────┬────┘   │
│       │                   │ 广告交易 │                │        │
│       ▼                   │   平台   │                ▼        │
│  ┌─────────┐              │         │           ┌─────────┐   │
│  │  DSP    │◀────────────▶│         │◀─────────▶│  SSP    │   │
│  │需求方平台│              └─────────┘           │供给方平台│   │
│  └────┬────┘                   ▲                └─────────┘   │
│       │                        │                              │
│       ▼                        │                              │
│  ┌─────────┐              ┌─────────┐                        │
│  │  DMP    │              │  DMP    │                        │
│  │数据管理 │              │数据交易 │                        │
│  │  平台   │              │  平台   │                        │
│  └─────────┘              └─────────┘                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### **各角色职责**

| 角色 | 全称 | 职责 | 代表公司 |
|-----|------|-----|---------|
| **ADX** | Ad Exchange | 提供实时竞价市场 | Google AdX, 腾讯广点通 |
| **DSP** | Demand-Side Platform | 代表广告主参与竞价 | Google DV360, The Trade Desk |
| **SSP** | Supply-Side Platform | 代表媒体管理流量变现 | Pubmatic, Magnite |
| **DMP** | Data Management Platform | 数据管理和人群画像 | Oracle DMP, Adobe DMP |

---

## 📊 DSP 详解

### **DSP 是什么？**

**DSP**（Demand-Side Platform）是帮助广告主**自动化采买广告流量**的平台。

### **DSP 核心功能**

```
┌─────────────────────────────────────────────────────────────────┐
│                      DSP 功能架构                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │                    人群管理                              │  │
│   │  • 重定向人群（访客找回）                                 │  │
│   │  • 相似人群扩展（Look-alike）                           │  │
│   │  • 第一方数据上传                                       │  │
│   │  • 第三方数据对接                                       │  │
│   └─────────────────────────────────────────────────────────┘  │
│                                                                 │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │                    出价策略                              │  │
│   │  • 固定出价                                             │  │
│   │  • 动态出价（根据转化价值）                              │  │
│   │  • 智能出价（机器学习优化）                              │  │
│   └─────────────────────────────────────────────────────────┘  │
│                                                                 │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │                    创意管理                              │  │
│   │  • 批量上传                                             │  │
│   │  • 动态创意                                             │  │
│   │  • A/B测试                                              │  │
│   └─────────────────────────────────────────────────────────┘  │
│                                                                 │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │                    效果监测                              │  │
│   │  • 转化追踪                                             │  │
│   │  • 归因分析                                             │  │
│   │  • ROI 报告                                             │  │
│   └─────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### **DSP 出价逻辑**

```
DSP 在收到竞价请求后：

输入：用户ID、页面信息、广告位信息

┌─────────────────────────────────────────────────────────┐
│                                                         │
│   1. 人群识别                                           │
│      └── 是否为目标人群？                               │
│          └── 重定向人群？相似人群？兴趣人群？            │
│                                                         │
│   2. 预估价值                                           │
│      └── 预估 CTR                                       │
│      └── 预估 CVR（转化率）                             │
│      └── 预估转化价值                                   │
│                                                         │
│   3. 计算出价                                           │
│      └── 出价 = 预估价值 × 目标ROI系数                  │
│                                                         │
│   4. 返回出价和创意                                      │
│                                                         │
└─────────────────────────────────────────────────────────┘

输出：出价金额、广告创意
```

---

## 📈 SSP 详解

### **SSP 是什么？**

**SSP**（Supply-Side Platform）是帮助媒体**管理和优化广告变现**的平台。

### **SSP 核心功能**

| 功能 | 说明 |
|-----|------|
| **流量管理** | 管理多个广告位、流量分配 |
| **价格底线** | 设置最低可接受出价 |
| **多渠道对接** | 同时接入多个ADX/广告网络 |
| **收益优化** | 动态选择变现效果最好的渠道 |
| **品牌安全** | 屏蔽不良广告主/创意 |

### **网络优化（Network Optimization）**

```
SSP 的核心价值：为媒体在多个渠道中选择最优变现

场景：媒体同时接入了多个广告来源

┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│   某次广告展示机会                                               │
│                                                                 │
│   渠道A（品牌直客）：CPM ¥50，优先级高                           │
│   渠道B（ADX 1）：实时出价 ¥35                                  │
│   渠道C（ADX 2）：实时出价 ¥42                                  │
│   渠道D（广告网络）：eCPM约 ¥30                                  │
│                                                                 │
│   SSP 决策：                                                     │
│   1. 先查询是否有品牌直客需求 ──▶ 有则优先满足                    │
│   2. 若无，向多个ADX发起竞价                                     │
│   3. 选择出价最高的ADX                                          │
│   4. 若出价低于底价，使用广告网络兜底                             │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 💾 DMP 详解

### **DMP 是什么？**

**DMP**（Data Management Platform）是用于**收集、整合、管理用户数据**并提供人群标签的平台。

### **数据类型**

```
┌─────────────────────────────────────────────────────────────────┐
│                      数据分类                                    │
├──────────────────┬──────────────────┬───────────────────────────┤
│    第一方数据      │    第二方数据      │      第三方数据           │
│  (1st Party)     │  (2nd Party)     │    (3rd Party)           │
├──────────────────┼──────────────────┼───────────────────────────┤
│                  │                  │                          │
│ 广告主自有数据    │ 合作方共享数据    │ 数据供应商数据            │
│                  │                  │                          │
│ • 官网访客       │ • 媒体分享       │ • 人口属性               │
│ • APP用户       │ • 合作伙伴       │ • 兴趣标签               │
│ • CRM数据       │ • 行业数据       │ • 购买意向               │
│ • 交易数据       │                  │ • 地理位置               │
│                  │                  │                          │
│ 【最有价值】      │                  │ 【覆盖面广】             │
│                  │                  │                          │
└──────────────────┴──────────────────┴───────────────────────────┘
```

### **DMP 核心能力**

| 能力 | 说明 |
|-----|------|
| **数据收集** | 多渠道数据采集、埋点管理 |
| **ID打通** | 跨设备、跨平台用户识别 |
| **标签体系** | 构建用户画像标签 |
| **人群圈选** | 基于标签创建目标人群 |
| **Look-alike** | 相似人群扩展 |
| **数据输出** | 对接DSP、广告平台 |

---

## 🔒 PMP（私有市场）

### **PMP 是什么？**

**PMP**（Private Marketplace）是介于合约广告和公开RTB之间的交易方式。

```
交易方式对比：

开放程度  ◀────────────────────────────────────────▶
          低                                      高
          │                                        │
          │   合约广告      PMP        公开RTB     │
          │      │          │            │        │
          │      ▼          ▼            ▼        │
          │   完全私有   受邀参与    完全开放       │
          │   固定价格   协商底价    市场竞价       │
          │   量保证     无保证      无保证        │
```

### **PMP 的类型**

| 类型 | 说明 | 特点 |
|-----|------|-----|
| **优先交易** | 单一买方优先获得流量 | 价格协商，无竞价 |
| **私有竞价** | 受邀买方之间竞价 | 有限竞争，质量可控 |
| **公开竞价** | 任何买方都可参与 | 完全市场化 |

### **PMP 的价值**

```
对媒体的价值：
• 保护优质流量价格
• 控制广告主质量
• 建立直客关系

对广告主的价值：
• 获取优质流量
• 减少竞争
• 品牌安全有保障
```

---

## 📱 Cookie Mapping

### **为什么需要 Cookie Mapping？**

```
问题：DSP 和 ADX 使用不同的用户ID

ADX 知道：用户的 Cookie = "abc123"
DSP 知道：该用户在DSP的ID = "xyz789"

但 DSP 不知道 "abc123" 就是 "xyz789"

解决：Cookie Mapping - 预先建立ID对应关系
```

### **Cookie Mapping 流程**

```
┌─────────────────────────────────────────────────────────────────┐
│                  Cookie Mapping 过程                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   预先同步（用户访问广告主网站时）：                              │
│                                                                 │
│   ① 用户访问广告主网站                                          │
│         │                                                       │
│         ▼                                                       │
│   ② DSP 在页面放置跟踪代码                                       │
│         │                                                       │
│         ▼                                                       │
│   ③ DSP 向 ADX 发起同步请求                                      │
│         │    请求包含：DSP用户ID                                 │
│         │                                                       │
│         ▼                                                       │
│   ④ ADX 返回自己的用户ID                                         │
│         │                                                       │
│         ▼                                                       │
│   ⑤ DSP 建立映射表：                                             │
│         DSP_ID="xyz789" ←→ ADX_ID="abc123"                     │
│                                                                 │
│   ─────────────────────────────────────────────────────────────│
│                                                                 │
│   竞价时使用：                                                   │
│                                                                 │
│   ADX 竞价请求：用户Cookie="abc123"                              │
│         │                                                       │
│         ▼                                                       │
│   DSP 查表：找到对应的DSP_ID="xyz789"                            │
│         │                                                       │
│         ▼                                                       │
│   DSP 识别出：这是我们的重定向用户！高价竞争！                      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📊 程序化交易的数据流

```
完整的程序化广告数据流：

┌────────────────────────────────────────────────────────────────────────┐
│                                                                        │
│  广告主网站                                  媒体网站                    │
│      │                                          │                      │
│      │ ① 安装像素/SDK                           │ ② 用户访问           │
│      ▼                                          ▼                      │
│  ┌────────┐                              ┌────────────┐               │
│  │  DMP   │──── 人群数据 ────────────────│    SSP     │               │
│  └────────┘                              └─────┬──────┘               │
│      │                                         │                       │
│      │ ③ 同步人群                              │ ④ 广告请求            │
│      ▼                                         ▼                       │
│  ┌────────┐    ⑦ 返回出价/创意          ┌────────────┐               │
│  │  DSP   │◀───────────────────────────│    ADX     │               │
│  └────────┘                              └────────────┘               │
│      │                                         │                       │
│      │ ⑤ 收到竞价请求                          │                       │
│      │ ⑥ 计算出价                              │                       │
│      │                                         │ ⑧ 返回广告            │
│      └─────────────────────────────────────────┘                       │
│                                                │                       │
│                                                ▼                       │
│                                          广告展示给用户                 │
│                                                                        │
└────────────────────────────────────────────────────────────────────────┘
```

---

## 🎓 本章小结

### **核心要点**

1. **RTB**：每次展示实时竞价，100ms内完成
2. **DSP**：代表广告主参与竞价，提供精准定向
3. **SSP**：代表媒体优化变现
4. **DMP**：管理用户数据，提供人群标签
5. **PMP**：私有市场，平衡质量和效率

### **关键对比**

| 对比项 | 合约广告 | 公开RTB | PMP |
|-------|---------|--------|-----|
| 价格确定 | 预先谈判 | 实时竞价 | 底价+竞价 |
| 量的保证 | 有 | 无 | 无 |
| 流量质量 | 高 | 参差不齐 | 较高 |
| 定向能力 | 弱 | 强 | 强 |

### **思考题**

1. 为什么RTB要求在100ms内完成？
2. DSP和广告网络有什么区别？
3. 为什么优质媒体偏好PMP？

---

## 📚 延伸阅读

- [06_受众定向技术](./06_受众定向技术.md) - 深入了解定向方法
- [07_点击率预测](./07_点击率预测.md) - 了解DSP出价依据
- [03_搜索与竞价广告](./03_搜索与竞价广告.md) - 对比竞价机制

---

*下一章：[原生广告与移动广告](./05_原生广告与移动广告.md)*

